var Lo=Object.defineProperty;var Fo=(Kt,Ft,Ut)=>Ft in Kt?Lo(Kt,Ft,{enumerable:!0,configurable:!0,writable:!0,value:Ut}):Kt[Ft]=Ut;var bn=(Kt,Ft,Ut)=>Fo(Kt,typeof Ft!="symbol"?Ft+"":Ft,Ut);(function(){"use strict";function Kt(h){return h&&h.__esModule&&Object.prototype.hasOwnProperty.call(h,"default")?h.default:h}function Ft(h){if(Object.prototype.hasOwnProperty.call(h,"__esModule"))return h;var t=h.default;if(typeof t=="function"){var e=function r(){return this instanceof r?Reflect.construct(t,arguments,this.constructor):t.apply(this,arguments)};e.prototype=t.prototype}else e={};return Object.defineProperty(e,"__esModule",{value:!0}),Object.keys(h).forEach(function(r){var i=Object.getOwnPropertyDescriptor(h,r);Object.defineProperty(e,r,i.get?i:{enumerable:!0,get:function(){return h[r]}})}),e}var Ut={exports:{}},Mn={},En=Object.freeze({__proto__:null,default:Mn}),ue=Ft(En);/**
 * workerpool.js
 * https://github.com/josdejong/workerpool
 *
 * Offload tasks to a pool of workers on node.js and in the browser.
 *
 * @version 9.2.0
 * @date    2024-10-11
 *
 * @license
 * Copyright (C) 2014-2022 Jos de Jong <wjosdejong@gmail.com>
 *
 * Licensed under the Apache License, Version 2.0 (the "License"); you may not
 * use this file except in compliance with the License. You may obtain a copy
 * of the License at
 *
 * http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS, WITHOUT
 * WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the
 * License for the specific language governing permissions and limitations under
 * the License.
 */var An=Ut.exports,ii;function vn(){return ii||(ii=1,function(h,t){(function(e,r){r(t)})(An,function(e){var r={},i={exports:{}};(function(w){var v=function(T){return typeof T<"u"&&T.versions!=null&&T.versions.node!=null&&T+""=="[object process]"};w.exports.isNode=v,w.exports.platform=typeof process<"u"&&v(process)?"node":"browser";var E=w.exports.platform==="node"&&ue;w.exports.isMainThread=w.exports.platform==="node"?(!E||E.isMainThread)&&!process.connected:typeof Window<"u",w.exports.cpus=w.exports.platform==="browser"?self.navigator.hardwareConcurrency:ue.cpus().length})(i);var n=i.exports,s={},o;function a(){if(o)return s;o=1;function w(T,$){var x=this;if(!(this instanceof w))throw new SyntaxError("Constructor must be called with the new operator");if(typeof T!="function")throw new SyntaxError("Function parameter handler(resolve, reject) missing");var rt=[],X=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var ft=function(g,z){rt.push(g),X.push(z)};this.then=function(M,g){return new w(function(z,R){var Y=M?v(M,z,R):z,yt=g?v(g,z,R):R;ft(Y,yt)},x)};var pt=function(g){return x.resolved=!0,x.rejected=!1,x.pending=!1,rt.forEach(function(z){z(g)}),ft=function(R,Y){R(g)},pt=k=function(){},x},k=function(g){return x.resolved=!1,x.rejected=!0,x.pending=!1,X.forEach(function(z){z(g)}),ft=function(R,Y){Y(g)},pt=k=function(){},x};this.cancel=function(){return $?$.cancel():k(new E),x},this.timeout=function(M){if($)$.timeout(M);else{var g=setTimeout(function(){k(new F("Promise timed out after "+M+" ms"))},M);x.always(function(){clearTimeout(g)})}return x},T(function(M){pt(M)},function(M){k(M)})}function v(T,$,x){return function(rt){try{var X=T(rt);X&&typeof X.then=="function"&&typeof X.catch=="function"?X.then($,x):$(X)}catch(ft){x(ft)}}}w.prototype.catch=function(T){return this.then(null,T)},w.prototype.always=function(T){return this.then(T,T)},w.prototype.finally=function(T){var $=this,x=function(){return new w(function(X){return X()}).then(T).then(function(){return $})};return this.then(x,x)},w.all=function(T){return new w(function($,x){var rt=T.length,X=[];rt?T.forEach(function(ft,pt){ft.then(function(k){X[pt]=k,rt--,rt==0&&$(X)},function(k){rt=0,x(k)})}):$(X)})},w.defer=function(){var T={};return T.promise=new w(function($,x){T.resolve=$,T.reject=x}),T};function E(T){this.message=T||"promise cancelled",this.stack=new Error().stack}E.prototype=new Error,E.prototype.constructor=Error,E.prototype.name="CancellationError",w.CancellationError=E;function F(T){this.message=T||"timeout exceeded",this.stack=new Error().stack}return F.prototype=new Error,F.prototype.constructor=Error,F.prototype.name="TimeoutError",w.TimeoutError=F,s.Promise=w,s}function u(w,v){(v==null||v>w.length)&&(v=w.length);for(var E=0,F=Array(v);E<v;E++)F[E]=w[E];return F}function c(w,v){var E=typeof Symbol<"u"&&w[Symbol.iterator]||w["@@iterator"];if(!E){if(Array.isArray(w)||(E=b(w))||v){E&&(w=E);var F=0,T=function(){};return{s:T,n:function(){return F>=w.length?{done:!0}:{done:!1,value:w[F++]}},e:function(X){throw X},f:T}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var $,x=!0,rt=!1;return{s:function(){E=E.call(w)},n:function(){var X=E.next();return x=X.done,X},e:function(X){rt=!0,$=X},f:function(){try{x||E.return==null||E.return()}finally{if(rt)throw $}}}}function l(w,v,E){return(v=p(v))in w?Object.defineProperty(w,v,{value:E,enumerable:!0,configurable:!0,writable:!0}):w[v]=E,w}function d(w,v){var E=Object.keys(w);if(Object.getOwnPropertySymbols){var F=Object.getOwnPropertySymbols(w);v&&(F=F.filter(function(T){return Object.getOwnPropertyDescriptor(w,T).enumerable})),E.push.apply(E,F)}return E}function f(w){for(var v=1;v<arguments.length;v++){var E=arguments[v]!=null?arguments[v]:{};v%2?d(Object(E),!0).forEach(function(F){l(w,F,E[F])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(E)):d(Object(E)).forEach(function(F){Object.defineProperty(w,F,Object.getOwnPropertyDescriptor(E,F))})}return w}function m(w,v){if(typeof w!="object"||!w)return w;var E=w[Symbol.toPrimitive];if(E!==void 0){var F=E.call(w,v);if(typeof F!="object")return F;throw new TypeError("@@toPrimitive must return a primitive value.")}return(v==="string"?String:Number)(w)}function p(w){var v=m(w,"string");return typeof v=="symbol"?v:v+""}function A(w){"@babel/helpers - typeof";return A=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(v){return typeof v}:function(v){return v&&typeof Symbol=="function"&&v.constructor===Symbol&&v!==Symbol.prototype?"symbol":typeof v},A(w)}function b(w,v){if(w){if(typeof w=="string")return u(w,v);var E={}.toString.call(w).slice(8,-1);return E==="Object"&&w.constructor&&(E=w.constructor.name),E==="Map"||E==="Set"?Array.from(w):E==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(E)?u(w,v):void 0}}var P={exports:{}},B={},L;function S(){return L||(L=1,B.validateOptions=function(v,E,F){if(v){var T=v?Object.keys(v):[],$=T.find(function(rt){return!E.includes(rt)});if($)throw new Error('Object "'+F+'" contains an unknown option "'+$+'"');var x=E.find(function(rt){return Object.prototype[rt]&&!T.includes(rt)});if(x)throw new Error('Object "'+F+'" contains an inherited option "'+x+'" which is not defined in the object itself but in its prototype. Only plain objects are allowed. Please remove the option from the prototype or override it with a value "undefined".');return v}},B.workerOptsNames=["credentials","name","type"],B.forkOptsNames=["cwd","detached","env","execPath","execArgv","gid","serialization","signal","killSignal","silent","stdio","uid","windowsVerbatimArguments","timeout"],B.workerThreadOptsNames=["argv","env","eval","execArgv","stdin","stdout","stderr","workerData","trackUnmanagedFds","transferList","resourceLimits","name"]),B}var q,C;function U(){return C||(C=1,q=`!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):(e="undefined"!=typeof globalThis?globalThis:e||self).worker=n()}(this,(function(){"use strict";function e(n){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(n)}function n(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var t={};var r=function(e,n){this.message=e,this.transfer=n},o={};function i(e,n){var t=this;if(!(this instanceof i))throw new SyntaxError("Constructor must be called with the new operator");if("function"!=typeof e)throw new SyntaxError("Function parameter handler(resolve, reject) missing");var r=[],o=[];this.resolved=!1,this.rejected=!1,this.pending=!0;var a=function(e,n){r.push(e),o.push(n)};this.then=function(e,n){return new i((function(t,r){var o=e?u(e,t,r):t,i=n?u(n,t,r):r;a(o,i)}),t)};var f=function(e){return t.resolved=!0,t.rejected=!1,t.pending=!1,r.forEach((function(n){n(e)})),a=function(n,t){n(e)},f=d=function(){},t},d=function(e){return t.resolved=!1,t.rejected=!0,t.pending=!1,o.forEach((function(n){n(e)})),a=function(n,t){t(e)},f=d=function(){},t};this.cancel=function(){return n?n.cancel():d(new s),t},this.timeout=function(e){if(n)n.timeout(e);else{var r=setTimeout((function(){d(new c("Promise timed out after "+e+" ms"))}),e);t.always((function(){clearTimeout(r)}))}return t},e((function(e){f(e)}),(function(e){d(e)}))}function u(e,n,t){return function(r){try{var o=e(r);o&&"function"==typeof o.then&&"function"==typeof o.catch?o.then(n,t):n(o)}catch(e){t(e)}}}function s(e){this.message=e||"promise cancelled",this.stack=(new Error).stack}function c(e){this.message=e||"timeout exceeded",this.stack=(new Error).stack}return i.prototype.catch=function(e){return this.then(null,e)},i.prototype.always=function(e){return this.then(e,e)},i.prototype.finally=function(e){var n=this,t=function(){return new i((function(e){return e()})).then(e).then((function(){return n}))};return this.then(t,t)},i.all=function(e){return new i((function(n,t){var r=e.length,o=[];r?e.forEach((function(e,i){e.then((function(e){o[i]=e,0==--r&&n(o)}),(function(e){r=0,t(e)}))})):n(o)}))},i.defer=function(){var e={};return e.promise=new i((function(n,t){e.resolve=n,e.reject=t})),e},s.prototype=new Error,s.prototype.constructor=Error,s.prototype.name="CancellationError",i.CancellationError=s,c.prototype=new Error,c.prototype.constructor=Error,c.prototype.name="TimeoutError",i.TimeoutError=c,o.Promise=i,function(n){var t=r,i=o.Promise,u="__workerpool-cleanup__",s={exit:function(){}},c={addAbortListener:function(e){s.abortListeners.push(e)},emit:s.emit};if("undefined"!=typeof self&&"function"==typeof postMessage&&"function"==typeof addEventListener)s.on=function(e,n){addEventListener(e,(function(e){n(e.data)}))},s.send=function(e,n){n?postMessage(e,n):postMessage(e)};else{if("undefined"==typeof process)throw new Error("Script must be executed as a worker");var a;try{a=require("worker_threads")}catch(n){if("object"!==e(n)||null===n||"MODULE_NOT_FOUND"!==n.code)throw n}if(a&&null!==a.parentPort){var f=a.parentPort;s.send=f.postMessage.bind(f),s.on=f.on.bind(f),s.exit=process.exit.bind(process)}else s.on=process.on.bind(process),s.send=function(e){process.send(e)},s.on("disconnect",(function(){process.exit(1)})),s.exit=process.exit.bind(process)}function d(e){return Object.getOwnPropertyNames(e).reduce((function(n,t){return Object.defineProperty(n,t,{value:e[t],enumerable:!0})}),{})}function l(e){return e&&"function"==typeof e.then&&"function"==typeof e.catch}s.methods={},s.methods.run=function(e,n){var t=new Function("return ("+e+").apply(this, arguments);");return t.worker=c,t.apply(t,n)},s.methods.methods=function(){return Object.keys(s.methods)},s.terminationHandler=void 0,s.abortListenerTimeout=1e3,s.abortListeners=[],s.terminateAndExit=function(e){var n=function(){s.exit(e)};if(!s.terminationHandler)return n();var t=s.terminationHandler(e);return l(t)?(t.then(n,n),t):(n(),new i((function(e,n){n(new Error("Worker terminating"))})))},s.cleanup=function(e){if(!s.abortListeners.length)return s.send({id:e,method:u,error:d(new Error("Worker terminating"))}),new i((function(e){e()}));var n,t=s.abortListeners.map((function(e){return e()})),r=new i((function(e,t){n=setTimeout((function(){t(new Error("Timeout occured waiting for abort handler, killing worker"))}),s.abortListenerTimeout)})),o=i.all(t).then((function(){clearTimeout(n),s.abortListeners.length||(s.abortListeners=[])}),(function(){clearTimeout(n),s.exit()}));return i.all([o,r]).then((function(){s.send({id:e,method:u,error:null})}),(function(n){s.send({id:e,method:u,error:n?d(n):null})}))};var p=null;s.on("message",(function(e){if("__workerpool-terminate__"===e)return s.terminateAndExit(0);if(e.method===u)return s.cleanup(e.id);try{var n=s.methods[e.method];if(!n)throw new Error('Unknown method "'+e.method+'"');p=e.id;var r=n.apply(n,e.params);l(r)?r.then((function(n){n instanceof t?s.send({id:e.id,result:n.message,error:null},n.transfer):s.send({id:e.id,result:n,error:null}),p=null})).catch((function(n){s.send({id:e.id,result:null,error:d(n)}),p=null})):(r instanceof t?s.send({id:e.id,result:r.message,error:null},r.transfer):s.send({id:e.id,result:r,error:null}),p=null)}catch(n){s.send({id:e.id,result:null,error:d(n)})}})),s.register=function(e,n){if(e)for(var t in e)e.hasOwnProperty(t)&&(s.methods[t]=e[t],s.methods[t].worker=c);n&&(s.terminationHandler=n.onTerminate,s.abortListenerTimeout=n.abortListenerTimeout||1e3),s.send("ready")},s.emit=function(e){if(p){if(e instanceof t)return void s.send({id:p,isEvent:!0,payload:e.message},e.transfer);s.send({id:p,isEvent:!0,payload:e})}},n.add=s.register,n.emit=s.emit}(t),n(t)}));
//# sourceMappingURL=worker.min.js.map
`),q}var Q;function st(){if(Q)return P.exports;Q=1;var w=a(),v=w.Promise,E=n,F=S(),T=F.validateOptions,$=F.forkOptsNames,x=F.workerThreadOptsNames,rt=F.workerOptsNames,X="__workerpool-terminate__",ft="__workerpool-cleanup__";function pt(){var O=M();if(!O)throw new Error("WorkerPool: workerType = 'thread' is not supported, Node >= 11.7.0 required");return O}function k(){if(typeof Worker!="function"&&((typeof Worker>"u"?"undefined":A(Worker))!=="object"||typeof Worker.prototype.constructor!="function"))throw new Error("WorkerPool: Web Workers not supported")}function M(){try{return ue}catch(O){if(A(O)==="object"&&O!==null&&O.code==="MODULE_NOT_FOUND")return null;throw O}}function g(){if(E.platform==="browser"){if(typeof Blob>"u")throw new Error("Blob not supported by the browser");if(!window.URL||typeof window.URL.createObjectURL!="function")throw new Error("URL.createObjectURL not supported by the browser");var O=new Blob([U()],{type:"text/javascript"});return window.URL.createObjectURL(O)}else return __dirname+"/worker.js"}function z(O,W){if(W.workerType==="web")return k(),R(O,W.workerOpts,Worker);if(W.workerType==="thread")return _=pt(),Y(O,_,W);if(W.workerType==="process"||!W.workerType)return yt(O,_t(W),ue);if(E.platform==="browser")return k(),R(O,W.workerOpts,Worker);var _=M();return _?Y(O,_,W):yt(O,_t(W),ue)}function R(O,W,_){T(W,rt,"workerOpts");var I=new _(O,W);return I.isBrowserWorker=!0,I.on=function(j,V){this.addEventListener(j,function(J){V(J.data)})},I.send=function(j,V){this.postMessage(j,V)},I}function Y(O,W,_){var I,j;T(_==null?void 0:_.workerThreadOpts,x,"workerThreadOpts");var V=new W.Worker(O,f({stdout:(I=_==null?void 0:_.emitStdStreams)!==null&&I!==void 0?I:!1,stderr:(j=_==null?void 0:_.emitStdStreams)!==null&&j!==void 0?j:!1},_==null?void 0:_.workerThreadOpts));return V.isWorkerThread=!0,V.send=function(J,D){this.postMessage(J,D)},V.kill=function(){return this.terminate(),!0},V.disconnect=function(){this.terminate()},_!=null&&_.emitStdStreams&&(V.stdout.on("data",function(J){return V.emit("stdout",J)}),V.stderr.on("data",function(J){return V.emit("stderr",J)})),V}function yt(O,W,_){T(W.forkOpts,$,"forkOpts");var I=_.fork(O,W.forkArgs,W.forkOpts),j=I.send;return I.send=function(V){return j.call(I,V)},W.emitStdStreams&&(I.stdout.on("data",function(V){return I.emit("stdout",V)}),I.stderr.on("data",function(V){return I.emit("stderr",V)})),I.isChildProcess=!0,I}function _t(O){O=O||{};var W=process.execArgv.join(" "),_=W.indexOf("--inspect")!==-1,I=W.indexOf("--debug-brk")!==-1,j=[];return _&&(j.push("--inspect="+O.debugPort),I&&j.push("--debug-brk")),process.execArgv.forEach(function(V){V.indexOf("--max-old-space-size")>-1&&j.push(V)}),Object.assign({},O,{forkArgs:O.forkArgs,forkOpts:Object.assign({},O.forkOpts,{execArgv:(O.forkOpts&&O.forkOpts.execArgv||[]).concat(j),stdio:O.emitStdStreams?"pipe":void 0})})}function Tt(O){for(var W=new Error(""),_=Object.keys(O),I=0;I<_.length;I++)W[_[I]]=O[_[I]];return W}function Ot(O,W){if(Object.keys(O.processing).length===1){var _=Object.values(O.processing)[0];_.options&&typeof _.options.on=="function"&&_.options.on(W)}}function Jt(O,W){var _=this,I=W||{};this.script=O||g(),this.worker=z(this.script,I),this.debugPort=I.debugPort,this.forkOpts=I.forkOpts,this.forkArgs=I.forkArgs,this.workerOpts=I.workerOpts,this.workerThreadOpts=I.workerThreadOpts,this.workerTerminateTimeout=I.workerTerminateTimeout,O||(this.worker.ready=!0),this.requestQueue=[],this.worker.on("stdout",function(D){Ot(_,{stdout:D.toString()})}),this.worker.on("stderr",function(D){Ot(_,{stderr:D.toString()})}),this.worker.on("message",function(D){if(!_.terminated)if(typeof D=="string"&&D==="ready")_.worker.ready=!0,V();else{var xt=D.id,at=_.processing[xt];if(at!==void 0&&(D.isEvent?at.options&&typeof at.options.on=="function"&&at.options.on(D.payload):(delete _.processing[xt],_.terminating===!0&&_.terminate(),D.error?at.resolver.reject(Tt(D.error)):at.resolver.resolve(D.result))),D.method===ft){var Mt=_.tracking[D.id];Mt!==void 0&&(D.error?(clearTimeout(Mt.timeoutId),Mt.resolver.reject(Tt(D.error))):(_.tracking&&clearTimeout(Mt.timeoutId),Mt.resolver.resolve(Mt.result))),delete _.tracking[xt]}}});function j(D){_.terminated=!0;for(var xt in _.processing)_.processing[xt]!==void 0&&_.processing[xt].resolver.reject(D);_.processing=Object.create(null)}function V(){var D=c(_.requestQueue.splice(0)),xt;try{for(D.s();!(xt=D.n()).done;){var at=xt.value;_.worker.send(at.message,at.transfer)}}catch(Mt){D.e(Mt)}finally{D.f()}}var J=this.worker;this.worker.on("error",j),this.worker.on("exit",function(D,xt){var at=`Workerpool Worker terminated Unexpectedly
`;at+="    exitCode: `"+D+"`\n",at+="    signalCode: `"+xt+"`\n",at+="    workerpool.script: `"+_.script+"`\n",at+="    spawnArgs: `"+J.spawnargs+"`\n",at+="    spawnfile: `"+J.spawnfile+"`\n",at+="    stdout: `"+J.stdout+"`\n",at+="    stderr: `"+J.stderr+"`\n",j(new Error(at))}),this.processing=Object.create(null),this.tracking=Object.create(null),this.terminating=!1,this.terminated=!1,this.cleaning=!1,this.terminationHandler=null,this.lastId=0}return Jt.prototype.methods=function(){return this.exec("methods")},Jt.prototype.exec=function(O,W,_,I){_||(_=v.defer());var j=++this.lastId;this.processing[j]={id:j,resolver:_,options:I};var V={message:{id:j,method:O,params:W},transfer:I&&I.transfer};this.terminated?_.reject(new Error("Worker is terminated")):this.worker.ready?this.worker.send(V.message,V.transfer):this.requestQueue.push(V);var J=this;return _.promise.catch(function(D){if(D instanceof v.CancellationError||D instanceof v.TimeoutError)return J.tracking[j]={id:j,resolver:v.defer()},delete J.processing[j],J.tracking[j].resolver.promise=J.tracking[j].resolver.promise.catch(function(xt){delete J.tracking[j];var at=J.terminateAndNotify(!0).then(function(){throw xt},function(Mt){throw Mt});return at}),J.worker.send({id:j,method:ft}),J.tracking[j].timeoutId=setTimeout(function(){J.tracking[j].resolver.reject(D)},J.workerTerminateTimeout),J.tracking[j].resolver.promise;throw D})},Jt.prototype.busy=function(){return this.cleaning||Object.keys(this.processing).length>0},Jt.prototype.terminate=function(O,W){var _=this;if(O){for(var I in this.processing)this.processing[I]!==void 0&&this.processing[I].resolver.reject(new Error("Worker terminated"));this.processing=Object.create(null)}for(var j=0,V=Object.values(_.tracking);j<V.length;j++){var J=V[j];clearTimeout(J.timeoutId),J.resolver.reject(new Error("Worker Terminating"))}if(_.tracking=Object.create(null),typeof W=="function"&&(this.terminationHandler=W),this.busy())this.terminating=!0;else{var D=function(Mt){if(_.terminated=!0,_.cleaning=!1,_.worker!=null&&_.worker.removeAllListeners&&_.worker.removeAllListeners("message"),_.worker=null,_.terminating=!1,_.terminationHandler)_.terminationHandler(Mt,_);else if(Mt)throw Mt};if(this.worker)if(typeof this.worker.kill=="function"){if(this.worker.killed){D(new Error("worker already killed!"));return}var xt=setTimeout(function(){_.worker&&_.worker.kill()},this.workerTerminateTimeout);this.worker.once("exit",function(){clearTimeout(xt),_.worker&&(_.worker.killed=!0),D()}),this.worker.ready?this.worker.send(X):this.requestQueue.push({message:X}),this.cleaning=!0;return}else if(typeof this.worker.terminate=="function")this.worker.terminate(),this.worker.killed=!0;else throw new Error("Failed to terminate worker");D()}},Jt.prototype.terminateAndNotify=function(O,W){var _=v.defer();return W&&_.promise.timeout(W),this.terminate(O,function(I,j){I?_.reject(I):_.resolve(j)}),_.promise},P.exports=Jt,P.exports._tryRequireWorkerThreads=M,P.exports._setupProcessWorker=yt,P.exports._setupBrowserWorker=R,P.exports._setupWorkerThreadWorker=Y,P.exports.ensureWorkerThreads=pt,P.exports}var et,kt;function dt(){if(kt)return et;kt=1;var w=65535;et=v;function v(){this.ports=Object.create(null),this.length=0}return v.prototype.nextAvailableStartingAt=function(E){for(;this.ports[E]===!0;)E++;if(E>=w)throw new Error("WorkerPool debug port limit reached: "+E+">= "+w);return this.ports[E]=!0,this.length++,E},v.prototype.releasePort=function(E){delete this.ports[E],this.length--},et}var St,se;function ze(){if(se)return St;se=1;var w=a(),v=w.Promise,E=st(),F=n,T=dt(),$=new T;function x(k,M){typeof k=="string"?this.script=k||null:(this.script=null,M=k),this.workers=[],this.tasks=[],M=M||{},this.forkArgs=Object.freeze(M.forkArgs||[]),this.forkOpts=Object.freeze(M.forkOpts||{}),this.workerOpts=Object.freeze(M.workerOpts||{}),this.workerThreadOpts=Object.freeze(M.workerThreadOpts||{}),this.debugPortStart=M.debugPortStart||43210,this.nodeWorker=M.nodeWorker,this.workerType=M.workerType||M.nodeWorker||"auto",this.maxQueueSize=M.maxQueueSize||1/0,this.workerTerminateTimeout=M.workerTerminateTimeout||1e3,this.onCreateWorker=M.onCreateWorker||function(){return null},this.onTerminateWorker=M.onTerminateWorker||function(){return null},this.emitStdStreams=M.emitStdStreams||!1,M&&"maxWorkers"in M?(rt(M.maxWorkers),this.maxWorkers=M.maxWorkers):this.maxWorkers=Math.max((F.cpus||4)-1,1),M&&"minWorkers"in M&&(M.minWorkers==="max"?this.minWorkers=this.maxWorkers:(X(M.minWorkers),this.minWorkers=M.minWorkers,this.maxWorkers=Math.max(this.minWorkers,this.maxWorkers)),this._ensureMinWorkers()),this._boundNext=this._next.bind(this),this.workerType==="thread"&&E.ensureWorkerThreads()}x.prototype.exec=function(k,M,g){if(M&&!Array.isArray(M))throw new TypeError('Array expected as argument "params"');if(typeof k=="string"){var z=v.defer();if(this.tasks.length>=this.maxQueueSize)throw new Error("Max queue size of "+this.maxQueueSize+" reached");var R=this.tasks,Y={method:k,params:M,resolver:z,timeout:null,options:g};R.push(Y);var yt=z.promise.timeout;return z.promise.timeout=function(Tt){return R.indexOf(Y)!==-1?(Y.timeout=Tt,z.promise):yt.call(z.promise,Tt)},this._next(),z.promise}else{if(typeof k=="function")return this.exec("run",[String(k),M],g);throw new TypeError('Function or string expected as argument "method"')}},x.prototype.proxy=function(){if(arguments.length>0)throw new Error("No arguments expected");var k=this;return this.exec("methods").then(function(M){var g={};return M.forEach(function(z){g[z]=function(){return k.exec(z,Array.prototype.slice.call(arguments))}}),g})},x.prototype._next=function(){if(this.tasks.length>0){var k=this._getWorker();if(k){var M=this,g=this.tasks.shift();if(g.resolver.promise.pending){var z=k.exec(g.method,g.params,g.resolver,g.options).then(M._boundNext).catch(function(){if(k.terminated)return M._removeWorker(k)}).then(function(){M._next()});typeof g.timeout=="number"&&z.timeout(g.timeout)}else M._next()}}},x.prototype._getWorker=function(){for(var k=this.workers,M=0;M<k.length;M++){var g=k[M];if(g.busy()===!1)return g}return k.length<this.maxWorkers?(g=this._createWorkerHandler(),k.push(g),g):null},x.prototype._removeWorker=function(k){var M=this;return $.releasePort(k.debugPort),this._removeWorkerFromList(k),this._ensureMinWorkers(),new v(function(g,z){k.terminate(!1,function(R){M.onTerminateWorker({forkArgs:k.forkArgs,forkOpts:k.forkOpts,workerThreadOpts:k.workerThreadOpts,script:k.script}),R?z(R):g(k)})})},x.prototype._removeWorkerFromList=function(k){var M=this.workers.indexOf(k);M!==-1&&this.workers.splice(M,1)},x.prototype.terminate=function(k,M){var g=this;this.tasks.forEach(function(_t){_t.resolver.reject(new Error("Pool terminated"))}),this.tasks.length=0;var z=function(Tt){$.releasePort(Tt.debugPort),this._removeWorkerFromList(Tt)},R=z.bind(this),Y=[],yt=this.workers.slice();return yt.forEach(function(_t){var Tt=_t.terminateAndNotify(k,M).then(R).always(function(){g.onTerminateWorker({forkArgs:_t.forkArgs,forkOpts:_t.forkOpts,workerThreadOpts:_t.workerThreadOpts,script:_t.script})});Y.push(Tt)}),v.all(Y)},x.prototype.stats=function(){var k=this.workers.length,M=this.workers.filter(function(g){return g.busy()}).length;return{totalWorkers:k,busyWorkers:M,idleWorkers:k-M,pendingTasks:this.tasks.length,activeTasks:M}},x.prototype._ensureMinWorkers=function(){if(this.minWorkers)for(var k=this.workers.length;k<this.minWorkers;k++)this.workers.push(this._createWorkerHandler())},x.prototype._createWorkerHandler=function(){var k=this.onCreateWorker({forkArgs:this.forkArgs,forkOpts:this.forkOpts,workerOpts:this.workerOpts,workerThreadOpts:this.workerThreadOpts,script:this.script})||{};return new E(k.script||this.script,{forkArgs:k.forkArgs||this.forkArgs,forkOpts:k.forkOpts||this.forkOpts,workerOpts:k.workerOpts||this.workerOpts,workerThreadOpts:k.workerThreadOpts||this.workerThreadOpts,debugPort:$.nextAvailableStartingAt(this.debugPortStart),workerType:this.workerType,workerTerminateTimeout:this.workerTerminateTimeout,emitStdStreams:this.emitStdStreams})};function rt(k){if(!ft(k)||!pt(k)||k<1)throw new TypeError("Option maxWorkers must be an integer number >= 1")}function X(k){if(!ft(k)||!pt(k)||k<0)throw new TypeError("Option minWorkers must be an integer number >= 0")}function ft(k){return typeof k=="number"}function pt(k){return Math.round(k)==k}return St=x,St}var Gt={},Qt,oe;function ae(){if(oe)return Qt;oe=1;function w(v,E){this.message=v,this.transfer=E}return Qt=w,Qt}var he;function wn(){return he||(he=1,function(w){var v=ae(),E=a().Promise,F="__workerpool-terminate__",T="__workerpool-cleanup__",$=1e3,x={exit:function(){}},rt={addAbortListener:function(z){x.abortListeners.push(z)},emit:x.emit};if(typeof self<"u"&&typeof postMessage=="function"&&typeof addEventListener=="function")x.on=function(g,z){addEventListener(g,function(R){z(R.data)})},x.send=function(g,z){z?postMessage(g,z):postMessage(g)};else if(typeof process<"u"){var X;try{X=ue}catch(g){if(!(A(g)==="object"&&g!==null&&g.code==="MODULE_NOT_FOUND"))throw g}if(X&&X.parentPort!==null){var ft=X.parentPort;x.send=ft.postMessage.bind(ft),x.on=ft.on.bind(ft),x.exit=process.exit.bind(process)}else x.on=process.on.bind(process),x.send=function(g){process.send(g)},x.on("disconnect",function(){process.exit(1)}),x.exit=process.exit.bind(process)}else throw new Error("Script must be executed as a worker");function pt(g){return Object.getOwnPropertyNames(g).reduce(function(z,R){return Object.defineProperty(z,R,{value:g[R],enumerable:!0})},{})}function k(g){return g&&typeof g.then=="function"&&typeof g.catch=="function"}x.methods={},x.methods.run=function(z,R){var Y=new Function("return ("+z+").apply(this, arguments);");return Y.worker=rt,Y.apply(Y,R)},x.methods.methods=function(){return Object.keys(x.methods)},x.terminationHandler=void 0,x.abortListenerTimeout=$,x.abortListeners=[],x.terminateAndExit=function(g){var z=function(){x.exit(g)};if(!x.terminationHandler)return z();var R=x.terminationHandler(g);return k(R)?(R.then(z,z),R):(z(),new E(function(Y,yt){yt(new Error("Worker terminating"))}))},x.cleanup=function(g){if(!x.abortListeners.length)return x.send({id:g,method:T,error:pt(new Error("Worker terminating"))}),new E(function(Ot){Ot()});var z=function(){x.exit()},R=function(){x.abortListeners.length||(x.abortListeners=[])},Y=x.abortListeners.map(function(Ot){return Ot()}),yt,_t=new E(function(Ot,Jt){yt=setTimeout(function(){Jt(new Error("Timeout occured waiting for abort handler, killing worker"))},x.abortListenerTimeout)}),Tt=E.all(Y).then(function(){clearTimeout(yt),R()},function(){clearTimeout(yt),z()});return E.all([Tt,_t]).then(function(){x.send({id:g,method:T,error:null})},function(Ot){x.send({id:g,method:T,error:Ot?pt(Ot):null})})};var M=null;x.on("message",function(g){if(g===F)return x.terminateAndExit(0);if(g.method===T)return x.cleanup(g.id);try{var z=x.methods[g.method];if(z){M=g.id;var R=z.apply(z,g.params);k(R)?R.then(function(Y){Y instanceof v?x.send({id:g.id,result:Y.message,error:null},Y.transfer):x.send({id:g.id,result:Y,error:null}),M=null}).catch(function(Y){x.send({id:g.id,result:null,error:pt(Y)}),M=null}):(R instanceof v?x.send({id:g.id,result:R.message,error:null},R.transfer):x.send({id:g.id,result:R,error:null}),M=null)}else throw new Error('Unknown method "'+g.method+'"')}catch(Y){x.send({id:g.id,result:null,error:pt(Y)})}}),x.register=function(g,z){if(g)for(var R in g)g.hasOwnProperty(R)&&(x.methods[R]=g[R],x.methods[R].worker=rt);z&&(x.terminationHandler=z.onTerminate,x.abortListenerTimeout=z.abortListenerTimeout||$),x.send("ready")},x.emit=function(g){if(M){if(g instanceof v){x.send({id:M,isEvent:!0,payload:g.message},g.transfer);return}x.send({id:M,isEvent:!0,payload:g})}},w.add=x.register,w.emit=x.emit}(Gt)),Gt}var Eo=n.platform,Ao=n.isMainThread,vo=n.cpus;function ko(w,v){var E=ze();return new E(w,v)}var zo=r.pool=ko;function So(w,v){var E=wn();E.add(w,v)}var To=r.worker=So;function Oo(w){var v=wn();v.emit(w)}var Po=r.workerEmit=Oo,Bo=a(),Co=Bo.Promise,Ro=r.Promise=Co,Io=r.Transfer=ae(),No=r.platform=Eo,Uo=r.isMainThread=Ao,Wo=r.cpus=vo;e.Promise=Ro,e.Transfer=Io,e.cpus=Wo,e.default=r,e.isMainThread=Uo,e.platform=No,e.pool=zo,e.worker=To,e.workerEmit=Po,Object.defineProperty(e,"__esModule",{value:!0})})}(Ut,Ut.exports)),Ut.exports}var kn=vn(),ni=Kt(kn);const zn=new Map([["centerX",Float64Array.BYTES_PER_ELEMENT],["centerY",Float64Array.BYTES_PER_ELEMENT],["centerZ",Float64Array.BYTES_PER_ELEMENT],["minHeight",Float32Array.BYTES_PER_ELEMENT],["maxHeight",Float32Array.BYTES_PER_ELEMENT],["boundingSphereCenterX",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterY",Float64Array.BYTES_PER_ELEMENT],["boundingSphereCenterZ",Float64Array.BYTES_PER_ELEMENT],["boundingSphereRadius",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointX",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointY",Float64Array.BYTES_PER_ELEMENT],["horizonOcclusionPointZ",Float64Array.BYTES_PER_ELEMENT]]);function Mr(h){return h>>1^-(h&1)}function Sn(h){let t=0;const e={};for(let[r,i]of zn){const n=i===8?h.getFloat64:h.getFloat32;e[r]=n.call(h,t,!0),t+=i}return{header:e,headerEndPosition:t}}function Tn(h,t){let e=t;const r=3,i=h.getUint32(e,!0),n=new Uint16Array(i*r);e+=Uint32Array.BYTES_PER_ELEMENT;const s=Uint16Array.BYTES_PER_ELEMENT,o=i*s,a=e,u=a+o,c=u+o;let l=0,d=0,f=0;for(let m=0;m<i;m++)l+=Mr(h.getUint16(a+s*m,!0)),d+=Mr(h.getUint16(u+s*m,!0)),f+=Mr(h.getUint16(c+s*m,!0)),n[m]=l,n[m+i]=d,n[m+i*2]=f;return e+=o*3,{vertexData:n,vertexDataEndPosition:e}}function Se(h,t,e,r,i=!0){let n;if(r===2?n=new Uint16Array(h,t,e):n=new Uint32Array(h,t,e),!i)return n;let s=0;for(let o=0;o<n.length;++o){let a=n[o];n[o]=s-a,a===0&&++s}return n}function On(h,t,e){let r=e;const s=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT;r%s!==0&&(r+=s-r%s);const o=h.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=o*3,u=Se(h.buffer,r,a,s);return r+=a*s,{triangleIndicesEndPosition:r,triangleIndices:u}}function Pn(h,t,e){let r=e;const s=t.length/3>65536?Uint32Array.BYTES_PER_ELEMENT:Uint16Array.BYTES_PER_ELEMENT,o=h.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const a=Se(h.buffer,r,o,s,!1);r+=o*s;const u=h.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const c=Se(h.buffer,r,u,s,!1);r+=u*s;const l=h.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const d=Se(h.buffer,r,l,s,!1);r+=l*s;const f=h.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const m=Se(h.buffer,r,f,s,!1);return r+=f*s,{edgeIndicesEndPosition:r,westIndices:a,southIndices:c,eastIndices:d,northIndices:m}}function Bn(h){return new Uint8Array(h.buffer,h.byteOffset,h.byteLength)}function Cn(h){return h.buffer.slice(h.byteOffset,h.byteOffset+h.byteLength)}function Rn(h){const t=h.getUint32(0,!0);let e="";for(let r=0;r<t;++r)e+=String.fromCharCode(h.getUint8(Uint32Array.BYTES_PER_ELEMENT+r));return JSON.parse(e)}function In(h,t){const e={};if(h.byteLength<=t)return{extensions:e,extensionsEndPosition:t};let r=t;for(;r<h.byteLength;){const i=h.getUint8(r,!0);r+=Uint8Array.BYTES_PER_ELEMENT;const n=h.getUint32(r,!0);r+=Uint32Array.BYTES_PER_ELEMENT;const s=new DataView(h.buffer,r,n);switch(i){case 1:{e.vertexNormals=Bn(s);break}case 2:{e.waterMask=Cn(s);break}case 4:{e.metadata=Rn(s);break}default:console.warn(`Unknown extension with id ${i}`)}r+=n}return{extensions:e,extensionsEndPosition:r}}const Te={vertices:1,triangleIndices:2,edgeIndices:3,extensions:4},Nn={maxDecodingStep:Te.extensions};function Un(h,t){const e=Object.assign({},Nn,t),r=new DataView(h),{header:i,headerEndPosition:n}=Sn(r);if(e.maxDecodingStep<Te.vertices)return{header:i};const{vertexData:s,vertexDataEndPosition:o}=Tn(r,n);if(e.maxDecodingStep<Te.triangleIndices)return{header:i,vertexData:s};const{triangleIndices:a,triangleIndicesEndPosition:u}=On(r,s,o);if(e.maxDecodingStep<Te.edgeIndices)return{header:i,vertexData:s,triangleIndices:a};const{westIndices:c,southIndices:l,eastIndices:d,northIndices:f,edgeIndicesEndPosition:m}=Pn(r,s,u);if(e.maxDecodingStep<Te.extensions)return{header:i,vertexData:s,triangleIndices:a,westIndices:c,northIndices:f,eastIndices:d,southIndices:l};const{extensions:p}=In(r,m);return{header:i,vertexData:s,triangleIndices:a,westIndices:c,northIndices:f,eastIndices:d,southIndices:l,extensions:p}}/**
 * @license
 * Copyright 2010-2025 Three.js Authors
 * SPDX-License-Identifier: MIT
 */const si="175",oi=300,ai=1e3,Xe=1001,hi=1002,Wn=1006,Ln=1008,Fn=1009,jn=1015,Dn=1023,qn="",ui=35044,Ve=2e3,ci=2001;class Er{addEventListener(t,e){this._listeners===void 0&&(this._listeners={});const r=this._listeners;r[t]===void 0&&(r[t]=[]),r[t].indexOf(e)===-1&&r[t].push(e)}hasEventListener(t,e){const r=this._listeners;return r===void 0?!1:r[t]!==void 0&&r[t].indexOf(e)!==-1}removeEventListener(t,e){const r=this._listeners;if(r===void 0)return;const i=r[t];if(i!==void 0){const n=i.indexOf(e);n!==-1&&i.splice(n,1)}}dispatchEvent(t){const e=this._listeners;if(e===void 0)return;const r=e[t.type];if(r!==void 0){t.target=this;const i=r.slice(0);for(let n=0,s=i.length;n<s;n++)i[n].call(this,t);t.target=null}}}const mt=["00","01","02","03","04","05","06","07","08","09","0a","0b","0c","0d","0e","0f","10","11","12","13","14","15","16","17","18","19","1a","1b","1c","1d","1e","1f","20","21","22","23","24","25","26","27","28","29","2a","2b","2c","2d","2e","2f","30","31","32","33","34","35","36","37","38","39","3a","3b","3c","3d","3e","3f","40","41","42","43","44","45","46","47","48","49","4a","4b","4c","4d","4e","4f","50","51","52","53","54","55","56","57","58","59","5a","5b","5c","5d","5e","5f","60","61","62","63","64","65","66","67","68","69","6a","6b","6c","6d","6e","6f","70","71","72","73","74","75","76","77","78","79","7a","7b","7c","7d","7e","7f","80","81","82","83","84","85","86","87","88","89","8a","8b","8c","8d","8e","8f","90","91","92","93","94","95","96","97","98","99","9a","9b","9c","9d","9e","9f","a0","a1","a2","a3","a4","a5","a6","a7","a8","a9","aa","ab","ac","ad","ae","af","b0","b1","b2","b3","b4","b5","b6","b7","b8","b9","ba","bb","bc","bd","be","bf","c0","c1","c2","c3","c4","c5","c6","c7","c8","c9","ca","cb","cc","cd","ce","cf","d0","d1","d2","d3","d4","d5","d6","d7","d8","d9","da","db","dc","dd","de","df","e0","e1","e2","e3","e4","e5","e6","e7","e8","e9","ea","eb","ec","ed","ee","ef","f0","f1","f2","f3","f4","f5","f6","f7","f8","f9","fa","fb","fc","fd","fe","ff"];function He(){const h=Math.random()*4294967295|0,t=Math.random()*4294967295|0,e=Math.random()*4294967295|0,r=Math.random()*4294967295|0;return(mt[h&255]+mt[h>>8&255]+mt[h>>16&255]+mt[h>>24&255]+"-"+mt[t&255]+mt[t>>8&255]+"-"+mt[t>>16&15|64]+mt[t>>24&255]+"-"+mt[e&63|128]+mt[e>>8&255]+"-"+mt[e>>16&255]+mt[e>>24&255]+mt[r&255]+mt[r>>8&255]+mt[r>>16&255]+mt[r>>24&255]).toLowerCase()}function ot(h,t,e){return Math.max(t,Math.min(e,h))}function Yn(h,t,e){return(1-e)*h+e*t}function Oe(h,t){switch(t.constructor){case Float32Array:return h;case Uint32Array:return h/4294967295;case Uint16Array:return h/65535;case Uint8Array:return h/255;case Int32Array:return Math.max(h/2147483647,-1);case Int16Array:return Math.max(h/32767,-1);case Int8Array:return Math.max(h/127,-1);default:throw new Error("Invalid component type.")}}function gt(h,t){switch(t.constructor){case Float32Array:return h;case Uint32Array:return Math.round(h*4294967295);case Uint16Array:return Math.round(h*65535);case Uint8Array:return Math.round(h*255);case Int32Array:return Math.round(h*2147483647);case Int16Array:return Math.round(h*32767);case Int8Array:return Math.round(h*127);default:throw new Error("Invalid component type.")}}const Xn={lerp:Yn};class Pt{constructor(t=0,e=0){Pt.prototype.isVector2=!0,this.x=t,this.y=e}get width(){return this.x}set width(t){this.x=t}get height(){return this.y}set height(t){this.y=t}set(t,e){return this.x=t,this.y=e,this}setScalar(t){return this.x=t,this.y=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y)}copy(t){return this.x=t.x,this.y=t.y,this}add(t){return this.x+=t.x,this.y+=t.y,this}addScalar(t){return this.x+=t,this.y+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this}subScalar(t){return this.x-=t,this.y-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this}multiply(t){return this.x*=t.x,this.y*=t.y,this}multiplyScalar(t){return this.x*=t,this.y*=t,this}divide(t){return this.x/=t.x,this.y/=t.y,this}divideScalar(t){return this.multiplyScalar(1/t)}applyMatrix3(t){const e=this.x,r=this.y,i=t.elements;return this.x=i[0]*e+i[3]*r+i[6],this.y=i[1]*e+i[4]*r+i[7],this}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this}clamp(t,e){return this.x=ot(this.x,t.x,e.x),this.y=ot(this.y,t.y,e.y),this}clampScalar(t,e){return this.x=ot(this.x,t,e),this.y=ot(this.y,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(ot(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this}negate(){return this.x=-this.x,this.y=-this.y,this}dot(t){return this.x*t.x+this.y*t.y}cross(t){return this.x*t.y-this.y*t.x}lengthSq(){return this.x*this.x+this.y*this.y}length(){return Math.sqrt(this.x*this.x+this.y*this.y)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)}normalize(){return this.divideScalar(this.length()||1)}angle(){return Math.atan2(-this.y,-this.x)+Math.PI}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(ot(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y;return e*e+r*r}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this}equals(t){return t.x===this.x&&t.y===this.y}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this}rotateAround(t,e){const r=Math.cos(e),i=Math.sin(e),n=this.x-t.x,s=this.y-t.y;return this.x=n*r-s*i+t.x,this.y=n*i+s*r+t.y,this}random(){return this.x=Math.random(),this.y=Math.random(),this}*[Symbol.iterator](){yield this.x,yield this.y}}class ce{constructor(t,e,r,i,n,s,o,a,u){ce.prototype.isMatrix3=!0,this.elements=[1,0,0,0,1,0,0,0,1],t!==void 0&&this.set(t,e,r,i,n,s,o,a,u)}set(t,e,r,i,n,s,o,a,u){const c=this.elements;return c[0]=t,c[1]=i,c[2]=o,c[3]=e,c[4]=n,c[5]=a,c[6]=r,c[7]=s,c[8]=u,this}identity(){return this.set(1,0,0,0,1,0,0,0,1),this}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],this}extractBasis(t,e,r){return t.setFromMatrix3Column(this,0),e.setFromMatrix3Column(this,1),r.setFromMatrix3Column(this,2),this}setFromMatrix4(t){const e=t.elements;return this.set(e[0],e[4],e[8],e[1],e[5],e[9],e[2],e[6],e[10]),this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,n=this.elements,s=r[0],o=r[3],a=r[6],u=r[1],c=r[4],l=r[7],d=r[2],f=r[5],m=r[8],p=i[0],A=i[3],b=i[6],P=i[1],B=i[4],L=i[7],S=i[2],q=i[5],C=i[8];return n[0]=s*p+o*P+a*S,n[3]=s*A+o*B+a*q,n[6]=s*b+o*L+a*C,n[1]=u*p+c*P+l*S,n[4]=u*A+c*B+l*q,n[7]=u*b+c*L+l*C,n[2]=d*p+f*P+m*S,n[5]=d*A+f*B+m*q,n[8]=d*b+f*L+m*C,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[3]*=t,e[6]*=t,e[1]*=t,e[4]*=t,e[7]*=t,e[2]*=t,e[5]*=t,e[8]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8];return e*s*c-e*o*u-r*n*c+r*o*a+i*n*u-i*s*a}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],l=c*s-o*u,d=o*a-c*n,f=u*n-s*a,m=e*l+r*d+i*f;if(m===0)return this.set(0,0,0,0,0,0,0,0,0);const p=1/m;return t[0]=l*p,t[1]=(i*u-c*r)*p,t[2]=(o*r-i*s)*p,t[3]=d*p,t[4]=(c*e-i*a)*p,t[5]=(i*n-o*e)*p,t[6]=f*p,t[7]=(r*a-u*e)*p,t[8]=(s*e-r*n)*p,this}transpose(){let t;const e=this.elements;return t=e[1],e[1]=e[3],e[3]=t,t=e[2],e[2]=e[6],e[6]=t,t=e[5],e[5]=e[7],e[7]=t,this}getNormalMatrix(t){return this.setFromMatrix4(t).invert().transpose()}transposeIntoArray(t){const e=this.elements;return t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8],this}setUvTransform(t,e,r,i,n,s,o){const a=Math.cos(n),u=Math.sin(n);return this.set(r*a,r*u,-r*(a*s+u*o)+s+t,-i*u,i*a,-i*(-u*s+a*o)+o+e,0,0,1),this}scale(t,e){return this.premultiply(Ar.makeScale(t,e)),this}rotate(t){return this.premultiply(Ar.makeRotation(-t)),this}translate(t,e){return this.premultiply(Ar.makeTranslation(t,e)),this}makeTranslation(t,e){return t.isVector2?this.set(1,0,t.x,0,1,t.y,0,0,1):this.set(1,0,t,0,1,e,0,0,1),this}makeRotation(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,r,e,0,0,0,1),this}makeScale(t,e){return this.set(t,0,0,0,e,0,0,0,1),this}equals(t){const e=this.elements,r=t.elements;for(let i=0;i<9;i++)if(e[i]!==r[i])return!1;return!0}fromArray(t,e=0){for(let r=0;r<9;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t}clone(){return new this.constructor().fromArray(this.elements)}}const Ar=new ce;function Vn(h){for(let t=h.length-1;t>=0;--t)if(h[t]>=65535)return!0;return!1}function li(h){return document.createElementNS("http://www.w3.org/1999/xhtml",h)}function vr(h){return h<.04045?h*.0773993808:Math.pow(h*.9478672986+.0521327014,2.4)}let le;class Hn{static getDataURL(t,e="image/png"){if(/^data:/i.test(t.src)||typeof HTMLCanvasElement>"u")return t.src;let r;if(t instanceof HTMLCanvasElement)r=t;else{le===void 0&&(le=li("canvas")),le.width=t.width,le.height=t.height;const i=le.getContext("2d");t instanceof ImageData?i.putImageData(t,0,0):i.drawImage(t,0,0,t.width,t.height),r=le}return r.toDataURL(e)}static sRGBToLinear(t){if(typeof HTMLImageElement<"u"&&t instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&t instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&t instanceof ImageBitmap){const e=li("canvas");e.width=t.width,e.height=t.height;const r=e.getContext("2d");r.drawImage(t,0,0,t.width,t.height);const i=r.getImageData(0,0,t.width,t.height),n=i.data;for(let s=0;s<n.length;s++)n[s]=vr(n[s]/255)*255;return r.putImageData(i,0,0),e}else if(t.data){const e=t.data.slice(0);for(let r=0;r<e.length;r++)e instanceof Uint8Array||e instanceof Uint8ClampedArray?e[r]=Math.floor(vr(e[r]/255)*255):e[r]=vr(e[r]);return{data:e,width:t.width,height:t.height}}else return console.warn("THREE.ImageUtils.sRGBToLinear(): Unsupported image type. No color space conversion applied."),t}}let Zn=0;class $n{constructor(t=null){this.isSource=!0,Object.defineProperty(this,"id",{value:Zn++}),this.uuid=He(),this.data=t,this.dataReady=!0,this.version=0}set needsUpdate(t){t===!0&&this.version++}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.images[this.uuid]!==void 0)return t.images[this.uuid];const r={uuid:this.uuid,url:""},i=this.data;if(i!==null){let n;if(Array.isArray(i)){n=[];for(let s=0,o=i.length;s<o;s++)i[s].isDataTexture?n.push(kr(i[s].image)):n.push(kr(i[s]))}else n=kr(i);r.url=n}return e||(t.images[this.uuid]=r),r}}function kr(h){return typeof HTMLImageElement<"u"&&h instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&h instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&h instanceof ImageBitmap?Hn.getDataURL(h):h.data?{data:Array.from(h.data),width:h.width,height:h.height,type:h.data.constructor.name}:(console.warn("THREE.Texture: Unable to serialize Texture."),{})}let Gn=0;class te extends Er{constructor(t=te.DEFAULT_IMAGE,e=te.DEFAULT_MAPPING,r=Xe,i=Xe,n=Wn,s=Ln,o=Dn,a=Fn,u=te.DEFAULT_ANISOTROPY,c=qn){super(),this.isTexture=!0,Object.defineProperty(this,"id",{value:Gn++}),this.uuid=He(),this.name="",this.source=new $n(t),this.mipmaps=[],this.mapping=e,this.channel=0,this.wrapS=r,this.wrapT=i,this.magFilter=n,this.minFilter=s,this.anisotropy=u,this.format=o,this.internalFormat=null,this.type=a,this.offset=new Pt(0,0),this.repeat=new Pt(1,1),this.center=new Pt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new ce,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.colorSpace=c,this.userData={},this.version=0,this.onUpdate=null,this.renderTarget=null,this.isRenderTargetTexture=!1,this.pmremVersion=0}get image(){return this.source.data}set image(t=null){this.source.data=t}updateMatrix(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)}clone(){return new this.constructor().copy(this)}copy(t){return this.name=t.name,this.source=t.source,this.mipmaps=t.mipmaps.slice(0),this.mapping=t.mapping,this.channel=t.channel,this.wrapS=t.wrapS,this.wrapT=t.wrapT,this.magFilter=t.magFilter,this.minFilter=t.minFilter,this.anisotropy=t.anisotropy,this.format=t.format,this.internalFormat=t.internalFormat,this.type=t.type,this.offset.copy(t.offset),this.repeat.copy(t.repeat),this.center.copy(t.center),this.rotation=t.rotation,this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrix.copy(t.matrix),this.generateMipmaps=t.generateMipmaps,this.premultiplyAlpha=t.premultiplyAlpha,this.flipY=t.flipY,this.unpackAlignment=t.unpackAlignment,this.colorSpace=t.colorSpace,this.renderTarget=t.renderTarget,this.isRenderTargetTexture=t.isRenderTargetTexture,this.userData=JSON.parse(JSON.stringify(t.userData)),this.needsUpdate=!0,this}toJSON(t){const e=t===void 0||typeof t=="string";if(!e&&t.textures[this.uuid]!==void 0)return t.textures[this.uuid];const r={metadata:{version:4.6,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,image:this.source.toJSON(t).uuid,mapping:this.mapping,channel:this.channel,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,internalFormat:this.internalFormat,type:this.type,colorSpace:this.colorSpace,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,generateMipmaps:this.generateMipmaps,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};return Object.keys(this.userData).length>0&&(r.userData=this.userData),e||(t.textures[this.uuid]=r),r}dispose(){this.dispatchEvent({type:"dispose"})}transformUv(t){if(this.mapping!==oi)return t;if(t.applyMatrix3(this.matrix),t.x<0||t.x>1)switch(this.wrapS){case ai:t.x=t.x-Math.floor(t.x);break;case Xe:t.x=t.x<0?0:1;break;case hi:Math.abs(Math.floor(t.x)%2)===1?t.x=Math.ceil(t.x)-t.x:t.x=t.x-Math.floor(t.x);break}if(t.y<0||t.y>1)switch(this.wrapT){case ai:t.y=t.y-Math.floor(t.y);break;case Xe:t.y=t.y<0?0:1;break;case hi:Math.abs(Math.floor(t.y)%2)===1?t.y=Math.ceil(t.y)-t.y:t.y=t.y-Math.floor(t.y);break}return this.flipY&&(t.y=1-t.y),t}set needsUpdate(t){t===!0&&(this.version++,this.source.needsUpdate=!0)}set needsPMREMUpdate(t){t===!0&&this.pmremVersion++}}te.DEFAULT_IMAGE=null,te.DEFAULT_MAPPING=oi,te.DEFAULT_ANISOTROPY=1;class Pe{constructor(t=0,e=0,r=0,i=1){this.isQuaternion=!0,this._x=t,this._y=e,this._z=r,this._w=i}static slerpFlat(t,e,r,i,n,s,o){let a=r[i+0],u=r[i+1],c=r[i+2],l=r[i+3];const d=n[s+0],f=n[s+1],m=n[s+2],p=n[s+3];if(o===0){t[e+0]=a,t[e+1]=u,t[e+2]=c,t[e+3]=l;return}if(o===1){t[e+0]=d,t[e+1]=f,t[e+2]=m,t[e+3]=p;return}if(l!==p||a!==d||u!==f||c!==m){let A=1-o;const b=a*d+u*f+c*m+l*p,P=b>=0?1:-1,B=1-b*b;if(B>Number.EPSILON){const S=Math.sqrt(B),q=Math.atan2(S,b*P);A=Math.sin(A*q)/S,o=Math.sin(o*q)/S}const L=o*P;if(a=a*A+d*L,u=u*A+f*L,c=c*A+m*L,l=l*A+p*L,A===1-o){const S=1/Math.sqrt(a*a+u*u+c*c+l*l);a*=S,u*=S,c*=S,l*=S}}t[e]=a,t[e+1]=u,t[e+2]=c,t[e+3]=l}static multiplyQuaternionsFlat(t,e,r,i,n,s){const o=r[i],a=r[i+1],u=r[i+2],c=r[i+3],l=n[s],d=n[s+1],f=n[s+2],m=n[s+3];return t[e]=o*m+c*l+a*f-u*d,t[e+1]=a*m+c*d+u*l-o*f,t[e+2]=u*m+c*f+o*d-a*l,t[e+3]=c*m-o*l-a*d-u*f,t}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get w(){return this._w}set w(t){this._w=t,this._onChangeCallback()}set(t,e,r,i){return this._x=t,this._y=e,this._z=r,this._w=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._w)}copy(t){return this._x=t.x,this._y=t.y,this._z=t.z,this._w=t.w,this._onChangeCallback(),this}setFromEuler(t,e=!0){const r=t._x,i=t._y,n=t._z,s=t._order,o=Math.cos,a=Math.sin,u=o(r/2),c=o(i/2),l=o(n/2),d=a(r/2),f=a(i/2),m=a(n/2);switch(s){case"XYZ":this._x=d*c*l+u*f*m,this._y=u*f*l-d*c*m,this._z=u*c*m+d*f*l,this._w=u*c*l-d*f*m;break;case"YXZ":this._x=d*c*l+u*f*m,this._y=u*f*l-d*c*m,this._z=u*c*m-d*f*l,this._w=u*c*l+d*f*m;break;case"ZXY":this._x=d*c*l-u*f*m,this._y=u*f*l+d*c*m,this._z=u*c*m+d*f*l,this._w=u*c*l-d*f*m;break;case"ZYX":this._x=d*c*l-u*f*m,this._y=u*f*l+d*c*m,this._z=u*c*m-d*f*l,this._w=u*c*l+d*f*m;break;case"YZX":this._x=d*c*l+u*f*m,this._y=u*f*l+d*c*m,this._z=u*c*m-d*f*l,this._w=u*c*l-d*f*m;break;case"XZY":this._x=d*c*l-u*f*m,this._y=u*f*l-d*c*m,this._z=u*c*m+d*f*l,this._w=u*c*l+d*f*m;break;default:console.warn("THREE.Quaternion: .setFromEuler() encountered an unknown order: "+s)}return e===!0&&this._onChangeCallback(),this}setFromAxisAngle(t,e){const r=e/2,i=Math.sin(r);return this._x=t.x*i,this._y=t.y*i,this._z=t.z*i,this._w=Math.cos(r),this._onChangeCallback(),this}setFromRotationMatrix(t){const e=t.elements,r=e[0],i=e[4],n=e[8],s=e[1],o=e[5],a=e[9],u=e[2],c=e[6],l=e[10],d=r+o+l;if(d>0){const f=.5/Math.sqrt(d+1);this._w=.25/f,this._x=(c-a)*f,this._y=(n-u)*f,this._z=(s-i)*f}else if(r>o&&r>l){const f=2*Math.sqrt(1+r-o-l);this._w=(c-a)/f,this._x=.25*f,this._y=(i+s)/f,this._z=(n+u)/f}else if(o>l){const f=2*Math.sqrt(1+o-r-l);this._w=(n-u)/f,this._x=(i+s)/f,this._y=.25*f,this._z=(a+c)/f}else{const f=2*Math.sqrt(1+l-r-o);this._w=(s-i)/f,this._x=(n+u)/f,this._y=(a+c)/f,this._z=.25*f}return this._onChangeCallback(),this}setFromUnitVectors(t,e){let r=t.dot(e)+1;return r<Number.EPSILON?(r=0,Math.abs(t.x)>Math.abs(t.z)?(this._x=-t.y,this._y=t.x,this._z=0,this._w=r):(this._x=0,this._y=-t.z,this._z=t.y,this._w=r)):(this._x=t.y*e.z-t.z*e.y,this._y=t.z*e.x-t.x*e.z,this._z=t.x*e.y-t.y*e.x,this._w=r),this.normalize()}angleTo(t){return 2*Math.acos(Math.abs(ot(this.dot(t),-1,1)))}rotateTowards(t,e){const r=this.angleTo(t);if(r===0)return this;const i=Math.min(1,e/r);return this.slerp(t,i),this}identity(){return this.set(0,0,0,1)}invert(){return this.conjugate()}conjugate(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this}dot(t){return this._x*t._x+this._y*t._y+this._z*t._z+this._w*t._w}lengthSq(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w}length(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)}normalize(){let t=this.length();return t===0?(this._x=0,this._y=0,this._z=0,this._w=1):(t=1/t,this._x=this._x*t,this._y=this._y*t,this._z=this._z*t,this._w=this._w*t),this._onChangeCallback(),this}multiply(t){return this.multiplyQuaternions(this,t)}premultiply(t){return this.multiplyQuaternions(t,this)}multiplyQuaternions(t,e){const r=t._x,i=t._y,n=t._z,s=t._w,o=e._x,a=e._y,u=e._z,c=e._w;return this._x=r*c+s*o+i*u-n*a,this._y=i*c+s*a+n*o-r*u,this._z=n*c+s*u+r*a-i*o,this._w=s*c-r*o-i*a-n*u,this._onChangeCallback(),this}slerp(t,e){if(e===0)return this;if(e===1)return this.copy(t);const r=this._x,i=this._y,n=this._z,s=this._w;let o=s*t._w+r*t._x+i*t._y+n*t._z;if(o<0?(this._w=-t._w,this._x=-t._x,this._y=-t._y,this._z=-t._z,o=-o):this.copy(t),o>=1)return this._w=s,this._x=r,this._y=i,this._z=n,this;const a=1-o*o;if(a<=Number.EPSILON){const f=1-e;return this._w=f*s+e*this._w,this._x=f*r+e*this._x,this._y=f*i+e*this._y,this._z=f*n+e*this._z,this.normalize(),this}const u=Math.sqrt(a),c=Math.atan2(u,o),l=Math.sin((1-e)*c)/u,d=Math.sin(e*c)/u;return this._w=s*l+this._w*d,this._x=r*l+this._x*d,this._y=i*l+this._y*d,this._z=n*l+this._z*d,this._onChangeCallback(),this}slerpQuaternions(t,e,r){return this.copy(t).slerp(e,r)}random(){const t=2*Math.PI*Math.random(),e=2*Math.PI*Math.random(),r=Math.random(),i=Math.sqrt(1-r),n=Math.sqrt(r);return this.set(i*Math.sin(t),i*Math.cos(t),n*Math.sin(e),n*Math.cos(e))}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._w===this._w}fromArray(t,e=0){return this._x=t[e],this._y=t[e+1],this._z=t[e+2],this._w=t[e+3],this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._w,t}fromBufferAttribute(t,e){return this._x=t.getX(e),this._y=t.getY(e),this._z=t.getZ(e),this._w=t.getW(e),this._onChangeCallback(),this}toJSON(){return this.toArray()}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._w}}class y{constructor(t=0,e=0,r=0){y.prototype.isVector3=!0,this.x=t,this.y=e,this.z=r}set(t,e,r){return r===void 0&&(r=this.z),this.x=t,this.y=e,this.z=r,this}setScalar(t){return this.x=t,this.y=t,this.z=t,this}setX(t){return this.x=t,this}setY(t){return this.y=t,this}setZ(t){return this.z=t,this}setComponent(t,e){switch(t){case 0:this.x=e;break;case 1:this.y=e;break;case 2:this.z=e;break;default:throw new Error("index is out of range: "+t)}return this}getComponent(t){switch(t){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+t)}}clone(){return new this.constructor(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}addScalar(t){return this.x+=t,this.y+=t,this.z+=t,this}addVectors(t,e){return this.x=t.x+e.x,this.y=t.y+e.y,this.z=t.z+e.z,this}addScaledVector(t,e){return this.x+=t.x*e,this.y+=t.y*e,this.z+=t.z*e,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}subScalar(t){return this.x-=t,this.y-=t,this.z-=t,this}subVectors(t,e){return this.x=t.x-e.x,this.y=t.y-e.y,this.z=t.z-e.z,this}multiply(t){return this.x*=t.x,this.y*=t.y,this.z*=t.z,this}multiplyScalar(t){return this.x*=t,this.y*=t,this.z*=t,this}multiplyVectors(t,e){return this.x=t.x*e.x,this.y=t.y*e.y,this.z=t.z*e.z,this}applyEuler(t){return this.applyQuaternion(di.setFromEuler(t))}applyAxisAngle(t,e){return this.applyQuaternion(di.setFromAxisAngle(t,e))}applyMatrix3(t){const e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[3]*r+n[6]*i,this.y=n[1]*e+n[4]*r+n[7]*i,this.z=n[2]*e+n[5]*r+n[8]*i,this}applyNormalMatrix(t){return this.applyMatrix3(t).normalize()}applyMatrix4(t){const e=this.x,r=this.y,i=this.z,n=t.elements,s=1/(n[3]*e+n[7]*r+n[11]*i+n[15]);return this.x=(n[0]*e+n[4]*r+n[8]*i+n[12])*s,this.y=(n[1]*e+n[5]*r+n[9]*i+n[13])*s,this.z=(n[2]*e+n[6]*r+n[10]*i+n[14])*s,this}applyQuaternion(t){const e=this.x,r=this.y,i=this.z,n=t.x,s=t.y,o=t.z,a=t.w,u=2*(s*i-o*r),c=2*(o*e-n*i),l=2*(n*r-s*e);return this.x=e+a*u+s*l-o*c,this.y=r+a*c+o*u-n*l,this.z=i+a*l+n*c-s*u,this}project(t){return this.applyMatrix4(t.matrixWorldInverse).applyMatrix4(t.projectionMatrix)}unproject(t){return this.applyMatrix4(t.projectionMatrixInverse).applyMatrix4(t.matrixWorld)}transformDirection(t){const e=this.x,r=this.y,i=this.z,n=t.elements;return this.x=n[0]*e+n[4]*r+n[8]*i,this.y=n[1]*e+n[5]*r+n[9]*i,this.z=n[2]*e+n[6]*r+n[10]*i,this.normalize()}divide(t){return this.x/=t.x,this.y/=t.y,this.z/=t.z,this}divideScalar(t){return this.multiplyScalar(1/t)}min(t){return this.x=Math.min(this.x,t.x),this.y=Math.min(this.y,t.y),this.z=Math.min(this.z,t.z),this}max(t){return this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.z=Math.max(this.z,t.z),this}clamp(t,e){return this.x=ot(this.x,t.x,e.x),this.y=ot(this.y,t.y,e.y),this.z=ot(this.z,t.z,e.z),this}clampScalar(t,e){return this.x=ot(this.x,t,e),this.y=ot(this.y,t,e),this.z=ot(this.z,t,e),this}clampLength(t,e){const r=this.length();return this.divideScalar(r||1).multiplyScalar(ot(r,t,e))}floor(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this}ceil(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this}round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this}roundToZero(){return this.x=Math.trunc(this.x),this.y=Math.trunc(this.y),this.z=Math.trunc(this.z),this}negate(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}lengthSq(){return this.x*this.x+this.y*this.y+this.z*this.z}length(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)}manhattanLength(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)}normalize(){return this.divideScalar(this.length()||1)}setLength(t){return this.normalize().multiplyScalar(t)}lerp(t,e){return this.x+=(t.x-this.x)*e,this.y+=(t.y-this.y)*e,this.z+=(t.z-this.z)*e,this}lerpVectors(t,e,r){return this.x=t.x+(e.x-t.x)*r,this.y=t.y+(e.y-t.y)*r,this.z=t.z+(e.z-t.z)*r,this}cross(t){return this.crossVectors(this,t)}crossVectors(t,e){const r=t.x,i=t.y,n=t.z,s=e.x,o=e.y,a=e.z;return this.x=i*a-n*o,this.y=n*s-r*a,this.z=r*o-i*s,this}projectOnVector(t){const e=t.lengthSq();if(e===0)return this.set(0,0,0);const r=t.dot(this)/e;return this.copy(t).multiplyScalar(r)}projectOnPlane(t){return zr.copy(this).projectOnVector(t),this.sub(zr)}reflect(t){return this.sub(zr.copy(t).multiplyScalar(2*this.dot(t)))}angleTo(t){const e=Math.sqrt(this.lengthSq()*t.lengthSq());if(e===0)return Math.PI/2;const r=this.dot(t)/e;return Math.acos(ot(r,-1,1))}distanceTo(t){return Math.sqrt(this.distanceToSquared(t))}distanceToSquared(t){const e=this.x-t.x,r=this.y-t.y,i=this.z-t.z;return e*e+r*r+i*i}manhattanDistanceTo(t){return Math.abs(this.x-t.x)+Math.abs(this.y-t.y)+Math.abs(this.z-t.z)}setFromSpherical(t){return this.setFromSphericalCoords(t.radius,t.phi,t.theta)}setFromSphericalCoords(t,e,r){const i=Math.sin(e)*t;return this.x=i*Math.sin(r),this.y=Math.cos(e)*t,this.z=i*Math.cos(r),this}setFromCylindrical(t){return this.setFromCylindricalCoords(t.radius,t.theta,t.y)}setFromCylindricalCoords(t,e,r){return this.x=t*Math.sin(e),this.y=r,this.z=t*Math.cos(e),this}setFromMatrixPosition(t){const e=t.elements;return this.x=e[12],this.y=e[13],this.z=e[14],this}setFromMatrixScale(t){const e=this.setFromMatrixColumn(t,0).length(),r=this.setFromMatrixColumn(t,1).length(),i=this.setFromMatrixColumn(t,2).length();return this.x=e,this.y=r,this.z=i,this}setFromMatrixColumn(t,e){return this.fromArray(t.elements,e*4)}setFromMatrix3Column(t,e){return this.fromArray(t.elements,e*3)}setFromEuler(t){return this.x=t._x,this.y=t._y,this.z=t._z,this}setFromColor(t){return this.x=t.r,this.y=t.g,this.z=t.b,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}fromBufferAttribute(t,e){return this.x=t.getX(e),this.y=t.getY(e),this.z=t.getZ(e),this}random(){return this.x=Math.random(),this.y=Math.random(),this.z=Math.random(),this}randomDirection(){const t=Math.random()*Math.PI*2,e=Math.random()*2-1,r=Math.sqrt(1-e*e);return this.x=r*Math.cos(t),this.y=e,this.z=r*Math.sin(t),this}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const zr=new y,di=new Pe;class de{constructor(t=new y(1/0,1/0,1/0),e=new y(-1/0,-1/0,-1/0)){this.isBox3=!0,this.min=t,this.max=e}set(t,e){return this.min.copy(t),this.max.copy(e),this}setFromArray(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e+=3)this.expandByPoint(Bt.fromArray(t,e));return this}setFromBufferAttribute(t){this.makeEmpty();for(let e=0,r=t.count;e<r;e++)this.expandByPoint(Bt.fromBufferAttribute(t,e));return this}setFromPoints(t){this.makeEmpty();for(let e=0,r=t.length;e<r;e++)this.expandByPoint(t[e]);return this}setFromCenterAndSize(t,e){const r=Bt.copy(e).multiplyScalar(.5);return this.min.copy(t).sub(r),this.max.copy(t).add(r),this}setFromObject(t,e=!1){return this.makeEmpty(),this.expandByObject(t,e)}clone(){return new this.constructor().copy(this)}copy(t){return this.min.copy(t.min),this.max.copy(t.max),this}makeEmpty(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this}isEmpty(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z}getCenter(t){return this.isEmpty()?t.set(0,0,0):t.addVectors(this.min,this.max).multiplyScalar(.5)}getSize(t){return this.isEmpty()?t.set(0,0,0):t.subVectors(this.max,this.min)}expandByPoint(t){return this.min.min(t),this.max.max(t),this}expandByVector(t){return this.min.sub(t),this.max.add(t),this}expandByScalar(t){return this.min.addScalar(-t),this.max.addScalar(t),this}expandByObject(t,e=!1){t.updateWorldMatrix(!1,!1);const r=t.geometry;if(r!==void 0){const n=r.getAttribute("position");if(e===!0&&n!==void 0&&t.isInstancedMesh!==!0)for(let s=0,o=n.count;s<o;s++)t.isMesh===!0?t.getVertexPosition(s,Bt):Bt.fromBufferAttribute(n,s),Bt.applyMatrix4(t.matrixWorld),this.expandByPoint(Bt);else t.boundingBox!==void 0?(t.boundingBox===null&&t.computeBoundingBox(),Ze.copy(t.boundingBox)):(r.boundingBox===null&&r.computeBoundingBox(),Ze.copy(r.boundingBox)),Ze.applyMatrix4(t.matrixWorld),this.union(Ze)}const i=t.children;for(let n=0,s=i.length;n<s;n++)this.expandByObject(i[n],e);return this}containsPoint(t){return t.x>=this.min.x&&t.x<=this.max.x&&t.y>=this.min.y&&t.y<=this.max.y&&t.z>=this.min.z&&t.z<=this.max.z}containsBox(t){return this.min.x<=t.min.x&&t.max.x<=this.max.x&&this.min.y<=t.min.y&&t.max.y<=this.max.y&&this.min.z<=t.min.z&&t.max.z<=this.max.z}getParameter(t,e){return e.set((t.x-this.min.x)/(this.max.x-this.min.x),(t.y-this.min.y)/(this.max.y-this.min.y),(t.z-this.min.z)/(this.max.z-this.min.z))}intersectsBox(t){return t.max.x>=this.min.x&&t.min.x<=this.max.x&&t.max.y>=this.min.y&&t.min.y<=this.max.y&&t.max.z>=this.min.z&&t.min.z<=this.max.z}intersectsSphere(t){return this.clampPoint(t.center,Bt),Bt.distanceToSquared(t.center)<=t.radius*t.radius}intersectsPlane(t){let e,r;return t.normal.x>0?(e=t.normal.x*this.min.x,r=t.normal.x*this.max.x):(e=t.normal.x*this.max.x,r=t.normal.x*this.min.x),t.normal.y>0?(e+=t.normal.y*this.min.y,r+=t.normal.y*this.max.y):(e+=t.normal.y*this.max.y,r+=t.normal.y*this.min.y),t.normal.z>0?(e+=t.normal.z*this.min.z,r+=t.normal.z*this.max.z):(e+=t.normal.z*this.max.z,r+=t.normal.z*this.min.z),e<=-t.constant&&r>=-t.constant}intersectsTriangle(t){if(this.isEmpty())return!1;this.getCenter(Be),$e.subVectors(this.max,Be),fe.subVectors(t.a,Be),me.subVectors(t.b,Be),pe.subVectors(t.c,Be),Xt.subVectors(me,fe),Vt.subVectors(pe,me),ee.subVectors(fe,pe);let e=[0,-Xt.z,Xt.y,0,-Vt.z,Vt.y,0,-ee.z,ee.y,Xt.z,0,-Xt.x,Vt.z,0,-Vt.x,ee.z,0,-ee.x,-Xt.y,Xt.x,0,-Vt.y,Vt.x,0,-ee.y,ee.x,0];return!Sr(e,fe,me,pe,$e)||(e=[1,0,0,0,1,0,0,0,1],!Sr(e,fe,me,pe,$e))?!1:(Ge.crossVectors(Xt,Vt),e=[Ge.x,Ge.y,Ge.z],Sr(e,fe,me,pe,$e))}clampPoint(t,e){return e.copy(t).clamp(this.min,this.max)}distanceToPoint(t){return this.clampPoint(t,Bt).distanceTo(t)}getBoundingSphere(t){return this.isEmpty()?t.makeEmpty():(this.getCenter(t.center),t.radius=this.getSize(Bt).length()*.5),t}intersect(t){return this.min.max(t.min),this.max.min(t.max),this.isEmpty()&&this.makeEmpty(),this}union(t){return this.min.min(t.min),this.max.max(t.max),this}applyMatrix4(t){return this.isEmpty()?this:(jt[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(t),jt[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(t),jt[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(t),jt[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(t),jt[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(t),jt[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(t),jt[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(t),jt[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(t),this.setFromPoints(jt),this)}translate(t){return this.min.add(t),this.max.add(t),this}equals(t){return t.min.equals(this.min)&&t.max.equals(this.max)}}const jt=[new y,new y,new y,new y,new y,new y,new y,new y],Bt=new y,Ze=new de,fe=new y,me=new y,pe=new y,Xt=new y,Vt=new y,ee=new y,Be=new y,$e=new y,Ge=new y,re=new y;function Sr(h,t,e,r,i){for(let n=0,s=h.length-3;n<=s;n+=3){re.fromArray(h,n);const o=i.x*Math.abs(re.x)+i.y*Math.abs(re.y)+i.z*Math.abs(re.z),a=t.dot(re),u=e.dot(re),c=r.dot(re);if(Math.max(-Math.max(a,u,c),Math.min(a,u,c))>o)return!1}return!0}const Qn=new de,Ce=new y,Tr=new y;class Or{constructor(t=new y,e=-1){this.isSphere=!0,this.center=t,this.radius=e}set(t,e){return this.center.copy(t),this.radius=e,this}setFromPoints(t,e){const r=this.center;e!==void 0?r.copy(e):Qn.setFromPoints(t).getCenter(r);let i=0;for(let n=0,s=t.length;n<s;n++)i=Math.max(i,r.distanceToSquared(t[n]));return this.radius=Math.sqrt(i),this}copy(t){return this.center.copy(t.center),this.radius=t.radius,this}isEmpty(){return this.radius<0}makeEmpty(){return this.center.set(0,0,0),this.radius=-1,this}containsPoint(t){return t.distanceToSquared(this.center)<=this.radius*this.radius}distanceToPoint(t){return t.distanceTo(this.center)-this.radius}intersectsSphere(t){const e=this.radius+t.radius;return t.center.distanceToSquared(this.center)<=e*e}intersectsBox(t){return t.intersectsSphere(this)}intersectsPlane(t){return Math.abs(t.distanceToPoint(this.center))<=this.radius}clampPoint(t,e){const r=this.center.distanceToSquared(t);return e.copy(t),r>this.radius*this.radius&&(e.sub(this.center).normalize(),e.multiplyScalar(this.radius).add(this.center)),e}getBoundingBox(t){return this.isEmpty()?(t.makeEmpty(),t):(t.set(this.center,this.center),t.expandByScalar(this.radius),t)}applyMatrix4(t){return this.center.applyMatrix4(t),this.radius=this.radius*t.getMaxScaleOnAxis(),this}translate(t){return this.center.add(t),this}expandByPoint(t){if(this.isEmpty())return this.center.copy(t),this.radius=0,this;Ce.subVectors(t,this.center);const e=Ce.lengthSq();if(e>this.radius*this.radius){const r=Math.sqrt(e),i=(r-this.radius)*.5;this.center.addScaledVector(Ce,i/r),this.radius+=i}return this}union(t){return t.isEmpty()?this:this.isEmpty()?(this.copy(t),this):(this.center.equals(t.center)===!0?this.radius=Math.max(this.radius,t.radius):(Tr.subVectors(t.center,this.center).setLength(t.radius),this.expandByPoint(Ce.copy(t.center).add(Tr)),this.expandByPoint(Ce.copy(t.center).sub(Tr))),this)}equals(t){return t.center.equals(this.center)&&t.radius===this.radius}clone(){return new this.constructor().copy(this)}}class Ct{constructor(t,e,r,i,n,s,o,a,u,c,l,d,f,m,p,A){Ct.prototype.isMatrix4=!0,this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],t!==void 0&&this.set(t,e,r,i,n,s,o,a,u,c,l,d,f,m,p,A)}set(t,e,r,i,n,s,o,a,u,c,l,d,f,m,p,A){const b=this.elements;return b[0]=t,b[4]=e,b[8]=r,b[12]=i,b[1]=n,b[5]=s,b[9]=o,b[13]=a,b[2]=u,b[6]=c,b[10]=l,b[14]=d,b[3]=f,b[7]=m,b[11]=p,b[15]=A,this}identity(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this}clone(){return new Ct().fromArray(this.elements)}copy(t){const e=this.elements,r=t.elements;return e[0]=r[0],e[1]=r[1],e[2]=r[2],e[3]=r[3],e[4]=r[4],e[5]=r[5],e[6]=r[6],e[7]=r[7],e[8]=r[8],e[9]=r[9],e[10]=r[10],e[11]=r[11],e[12]=r[12],e[13]=r[13],e[14]=r[14],e[15]=r[15],this}copyPosition(t){const e=this.elements,r=t.elements;return e[12]=r[12],e[13]=r[13],e[14]=r[14],this}setFromMatrix3(t){const e=t.elements;return this.set(e[0],e[3],e[6],0,e[1],e[4],e[7],0,e[2],e[5],e[8],0,0,0,0,1),this}extractBasis(t,e,r){return t.setFromMatrixColumn(this,0),e.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this}makeBasis(t,e,r){return this.set(t.x,e.x,r.x,0,t.y,e.y,r.y,0,t.z,e.z,r.z,0,0,0,0,1),this}extractRotation(t){const e=this.elements,r=t.elements,i=1/ye.setFromMatrixColumn(t,0).length(),n=1/ye.setFromMatrixColumn(t,1).length(),s=1/ye.setFromMatrixColumn(t,2).length();return e[0]=r[0]*i,e[1]=r[1]*i,e[2]=r[2]*i,e[3]=0,e[4]=r[4]*n,e[5]=r[5]*n,e[6]=r[6]*n,e[7]=0,e[8]=r[8]*s,e[9]=r[9]*s,e[10]=r[10]*s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromEuler(t){const e=this.elements,r=t.x,i=t.y,n=t.z,s=Math.cos(r),o=Math.sin(r),a=Math.cos(i),u=Math.sin(i),c=Math.cos(n),l=Math.sin(n);if(t.order==="XYZ"){const d=s*c,f=s*l,m=o*c,p=o*l;e[0]=a*c,e[4]=-a*l,e[8]=u,e[1]=f+m*u,e[5]=d-p*u,e[9]=-o*a,e[2]=p-d*u,e[6]=m+f*u,e[10]=s*a}else if(t.order==="YXZ"){const d=a*c,f=a*l,m=u*c,p=u*l;e[0]=d+p*o,e[4]=m*o-f,e[8]=s*u,e[1]=s*l,e[5]=s*c,e[9]=-o,e[2]=f*o-m,e[6]=p+d*o,e[10]=s*a}else if(t.order==="ZXY"){const d=a*c,f=a*l,m=u*c,p=u*l;e[0]=d-p*o,e[4]=-s*l,e[8]=m+f*o,e[1]=f+m*o,e[5]=s*c,e[9]=p-d*o,e[2]=-s*u,e[6]=o,e[10]=s*a}else if(t.order==="ZYX"){const d=s*c,f=s*l,m=o*c,p=o*l;e[0]=a*c,e[4]=m*u-f,e[8]=d*u+p,e[1]=a*l,e[5]=p*u+d,e[9]=f*u-m,e[2]=-u,e[6]=o*a,e[10]=s*a}else if(t.order==="YZX"){const d=s*a,f=s*u,m=o*a,p=o*u;e[0]=a*c,e[4]=p-d*l,e[8]=m*l+f,e[1]=l,e[5]=s*c,e[9]=-o*c,e[2]=-u*c,e[6]=f*l+m,e[10]=d-p*l}else if(t.order==="XZY"){const d=s*a,f=s*u,m=o*a,p=o*u;e[0]=a*c,e[4]=-l,e[8]=u*c,e[1]=d*l+p,e[5]=s*c,e[9]=f*l-m,e[2]=m*l-f,e[6]=o*c,e[10]=p*l+d}return e[3]=0,e[7]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,this}makeRotationFromQuaternion(t){return this.compose(Jn,t,Kn)}lookAt(t,e,r){const i=this.elements;return Et.subVectors(t,e),Et.lengthSq()===0&&(Et.z=1),Et.normalize(),Ht.crossVectors(r,Et),Ht.lengthSq()===0&&(Math.abs(r.z)===1?Et.x+=1e-4:Et.z+=1e-4,Et.normalize(),Ht.crossVectors(r,Et)),Ht.normalize(),Qe.crossVectors(Et,Ht),i[0]=Ht.x,i[4]=Qe.x,i[8]=Et.x,i[1]=Ht.y,i[5]=Qe.y,i[9]=Et.y,i[2]=Ht.z,i[6]=Qe.z,i[10]=Et.z,this}multiply(t){return this.multiplyMatrices(this,t)}premultiply(t){return this.multiplyMatrices(t,this)}multiplyMatrices(t,e){const r=t.elements,i=e.elements,n=this.elements,s=r[0],o=r[4],a=r[8],u=r[12],c=r[1],l=r[5],d=r[9],f=r[13],m=r[2],p=r[6],A=r[10],b=r[14],P=r[3],B=r[7],L=r[11],S=r[15],q=i[0],C=i[4],U=i[8],Q=i[12],st=i[1],et=i[5],kt=i[9],dt=i[13],St=i[2],se=i[6],ze=i[10],Gt=i[14],Qt=i[3],oe=i[7],ae=i[11],he=i[15];return n[0]=s*q+o*st+a*St+u*Qt,n[4]=s*C+o*et+a*se+u*oe,n[8]=s*U+o*kt+a*ze+u*ae,n[12]=s*Q+o*dt+a*Gt+u*he,n[1]=c*q+l*st+d*St+f*Qt,n[5]=c*C+l*et+d*se+f*oe,n[9]=c*U+l*kt+d*ze+f*ae,n[13]=c*Q+l*dt+d*Gt+f*he,n[2]=m*q+p*st+A*St+b*Qt,n[6]=m*C+p*et+A*se+b*oe,n[10]=m*U+p*kt+A*ze+b*ae,n[14]=m*Q+p*dt+A*Gt+b*he,n[3]=P*q+B*st+L*St+S*Qt,n[7]=P*C+B*et+L*se+S*oe,n[11]=P*U+B*kt+L*ze+S*ae,n[15]=P*Q+B*dt+L*Gt+S*he,this}multiplyScalar(t){const e=this.elements;return e[0]*=t,e[4]*=t,e[8]*=t,e[12]*=t,e[1]*=t,e[5]*=t,e[9]*=t,e[13]*=t,e[2]*=t,e[6]*=t,e[10]*=t,e[14]*=t,e[3]*=t,e[7]*=t,e[11]*=t,e[15]*=t,this}determinant(){const t=this.elements,e=t[0],r=t[4],i=t[8],n=t[12],s=t[1],o=t[5],a=t[9],u=t[13],c=t[2],l=t[6],d=t[10],f=t[14],m=t[3],p=t[7],A=t[11],b=t[15];return m*(+n*a*l-i*u*l-n*o*d+r*u*d+i*o*f-r*a*f)+p*(+e*a*f-e*u*d+n*s*d-i*s*f+i*u*c-n*a*c)+A*(+e*u*l-e*o*f-n*s*l+r*s*f+n*o*c-r*u*c)+b*(-i*o*c-e*a*l+e*o*d+i*s*l-r*s*d+r*a*c)}transpose(){const t=this.elements;let e;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this}setPosition(t,e,r){const i=this.elements;return t.isVector3?(i[12]=t.x,i[13]=t.y,i[14]=t.z):(i[12]=t,i[13]=e,i[14]=r),this}invert(){const t=this.elements,e=t[0],r=t[1],i=t[2],n=t[3],s=t[4],o=t[5],a=t[6],u=t[7],c=t[8],l=t[9],d=t[10],f=t[11],m=t[12],p=t[13],A=t[14],b=t[15],P=l*A*u-p*d*u+p*a*f-o*A*f-l*a*b+o*d*b,B=m*d*u-c*A*u-m*a*f+s*A*f+c*a*b-s*d*b,L=c*p*u-m*l*u+m*o*f-s*p*f-c*o*b+s*l*b,S=m*l*a-c*p*a-m*o*d+s*p*d+c*o*A-s*l*A,q=e*P+r*B+i*L+n*S;if(q===0)return this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0);const C=1/q;return t[0]=P*C,t[1]=(p*d*n-l*A*n-p*i*f+r*A*f+l*i*b-r*d*b)*C,t[2]=(o*A*n-p*a*n+p*i*u-r*A*u-o*i*b+r*a*b)*C,t[3]=(l*a*n-o*d*n-l*i*u+r*d*u+o*i*f-r*a*f)*C,t[4]=B*C,t[5]=(c*A*n-m*d*n+m*i*f-e*A*f-c*i*b+e*d*b)*C,t[6]=(m*a*n-s*A*n-m*i*u+e*A*u+s*i*b-e*a*b)*C,t[7]=(s*d*n-c*a*n+c*i*u-e*d*u-s*i*f+e*a*f)*C,t[8]=L*C,t[9]=(m*l*n-c*p*n-m*r*f+e*p*f+c*r*b-e*l*b)*C,t[10]=(s*p*n-m*o*n+m*r*u-e*p*u-s*r*b+e*o*b)*C,t[11]=(c*o*n-s*l*n-c*r*u+e*l*u+s*r*f-e*o*f)*C,t[12]=S*C,t[13]=(c*p*i-m*l*i+m*r*d-e*p*d-c*r*A+e*l*A)*C,t[14]=(m*o*i-s*p*i-m*r*a+e*p*a+s*r*A-e*o*A)*C,t[15]=(s*l*i-c*o*i+c*r*a-e*l*a-s*r*d+e*o*d)*C,this}scale(t){const e=this.elements,r=t.x,i=t.y,n=t.z;return e[0]*=r,e[4]*=i,e[8]*=n,e[1]*=r,e[5]*=i,e[9]*=n,e[2]*=r,e[6]*=i,e[10]*=n,e[3]*=r,e[7]*=i,e[11]*=n,this}getMaxScaleOnAxis(){const t=this.elements,e=t[0]*t[0]+t[1]*t[1]+t[2]*t[2],r=t[4]*t[4]+t[5]*t[5]+t[6]*t[6],i=t[8]*t[8]+t[9]*t[9]+t[10]*t[10];return Math.sqrt(Math.max(e,r,i))}makeTranslation(t,e,r){return t.isVector3?this.set(1,0,0,t.x,0,1,0,t.y,0,0,1,t.z,0,0,0,1):this.set(1,0,0,t,0,1,0,e,0,0,1,r,0,0,0,1),this}makeRotationX(t){const e=Math.cos(t),r=Math.sin(t);return this.set(1,0,0,0,0,e,-r,0,0,r,e,0,0,0,0,1),this}makeRotationY(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,0,r,0,0,1,0,0,-r,0,e,0,0,0,0,1),this}makeRotationZ(t){const e=Math.cos(t),r=Math.sin(t);return this.set(e,-r,0,0,r,e,0,0,0,0,1,0,0,0,0,1),this}makeRotationAxis(t,e){const r=Math.cos(e),i=Math.sin(e),n=1-r,s=t.x,o=t.y,a=t.z,u=n*s,c=n*o;return this.set(u*s+r,u*o-i*a,u*a+i*o,0,u*o+i*a,c*o+r,c*a-i*s,0,u*a-i*o,c*a+i*s,n*a*a+r,0,0,0,0,1),this}makeScale(t,e,r){return this.set(t,0,0,0,0,e,0,0,0,0,r,0,0,0,0,1),this}makeShear(t,e,r,i,n,s){return this.set(1,r,n,0,t,1,s,0,e,i,1,0,0,0,0,1),this}compose(t,e,r){const i=this.elements,n=e._x,s=e._y,o=e._z,a=e._w,u=n+n,c=s+s,l=o+o,d=n*u,f=n*c,m=n*l,p=s*c,A=s*l,b=o*l,P=a*u,B=a*c,L=a*l,S=r.x,q=r.y,C=r.z;return i[0]=(1-(p+b))*S,i[1]=(f+L)*S,i[2]=(m-B)*S,i[3]=0,i[4]=(f-L)*q,i[5]=(1-(d+b))*q,i[6]=(A+P)*q,i[7]=0,i[8]=(m+B)*C,i[9]=(A-P)*C,i[10]=(1-(d+p))*C,i[11]=0,i[12]=t.x,i[13]=t.y,i[14]=t.z,i[15]=1,this}decompose(t,e,r){const i=this.elements;let n=ye.set(i[0],i[1],i[2]).length();const s=ye.set(i[4],i[5],i[6]).length(),o=ye.set(i[8],i[9],i[10]).length();this.determinant()<0&&(n=-n),t.x=i[12],t.y=i[13],t.z=i[14],Rt.copy(this);const u=1/n,c=1/s,l=1/o;return Rt.elements[0]*=u,Rt.elements[1]*=u,Rt.elements[2]*=u,Rt.elements[4]*=c,Rt.elements[5]*=c,Rt.elements[6]*=c,Rt.elements[8]*=l,Rt.elements[9]*=l,Rt.elements[10]*=l,e.setFromRotationMatrix(Rt),r.x=n,r.y=s,r.z=o,this}makePerspective(t,e,r,i,n,s,o=Ve){const a=this.elements,u=2*n/(e-t),c=2*n/(r-i),l=(e+t)/(e-t),d=(r+i)/(r-i);let f,m;if(o===Ve)f=-(s+n)/(s-n),m=-2*s*n/(s-n);else if(o===ci)f=-s/(s-n),m=-s*n/(s-n);else throw new Error("THREE.Matrix4.makePerspective(): Invalid coordinate system: "+o);return a[0]=u,a[4]=0,a[8]=l,a[12]=0,a[1]=0,a[5]=c,a[9]=d,a[13]=0,a[2]=0,a[6]=0,a[10]=f,a[14]=m,a[3]=0,a[7]=0,a[11]=-1,a[15]=0,this}makeOrthographic(t,e,r,i,n,s,o=Ve){const a=this.elements,u=1/(e-t),c=1/(r-i),l=1/(s-n),d=(e+t)*u,f=(r+i)*c;let m,p;if(o===Ve)m=(s+n)*l,p=-2*l;else if(o===ci)m=n*l,p=-1*l;else throw new Error("THREE.Matrix4.makeOrthographic(): Invalid coordinate system: "+o);return a[0]=2*u,a[4]=0,a[8]=0,a[12]=-d,a[1]=0,a[5]=2*c,a[9]=0,a[13]=-f,a[2]=0,a[6]=0,a[10]=p,a[14]=-m,a[3]=0,a[7]=0,a[11]=0,a[15]=1,this}equals(t){const e=this.elements,r=t.elements;for(let i=0;i<16;i++)if(e[i]!==r[i])return!1;return!0}fromArray(t,e=0){for(let r=0;r<16;r++)this.elements[r]=t[r+e];return this}toArray(t=[],e=0){const r=this.elements;return t[e]=r[0],t[e+1]=r[1],t[e+2]=r[2],t[e+3]=r[3],t[e+4]=r[4],t[e+5]=r[5],t[e+6]=r[6],t[e+7]=r[7],t[e+8]=r[8],t[e+9]=r[9],t[e+10]=r[10],t[e+11]=r[11],t[e+12]=r[12],t[e+13]=r[13],t[e+14]=r[14],t[e+15]=r[15],t}}const ye=new y,Rt=new Ct,Jn=new y(0,0,0),Kn=new y(1,1,1),Ht=new y,Qe=new y,Et=new y,fi=new Ct,mi=new Pe;class Je{constructor(t=0,e=0,r=0,i=Je.DEFAULT_ORDER){this.isEuler=!0,this._x=t,this._y=e,this._z=r,this._order=i}get x(){return this._x}set x(t){this._x=t,this._onChangeCallback()}get y(){return this._y}set y(t){this._y=t,this._onChangeCallback()}get z(){return this._z}set z(t){this._z=t,this._onChangeCallback()}get order(){return this._order}set order(t){this._order=t,this._onChangeCallback()}set(t,e,r,i=this._order){return this._x=t,this._y=e,this._z=r,this._order=i,this._onChangeCallback(),this}clone(){return new this.constructor(this._x,this._y,this._z,this._order)}copy(t){return this._x=t._x,this._y=t._y,this._z=t._z,this._order=t._order,this._onChangeCallback(),this}setFromRotationMatrix(t,e=this._order,r=!0){const i=t.elements,n=i[0],s=i[4],o=i[8],a=i[1],u=i[5],c=i[9],l=i[2],d=i[6],f=i[10];switch(e){case"XYZ":this._y=Math.asin(ot(o,-1,1)),Math.abs(o)<.9999999?(this._x=Math.atan2(-c,f),this._z=Math.atan2(-s,n)):(this._x=Math.atan2(d,u),this._z=0);break;case"YXZ":this._x=Math.asin(-ot(c,-1,1)),Math.abs(c)<.9999999?(this._y=Math.atan2(o,f),this._z=Math.atan2(a,u)):(this._y=Math.atan2(-l,n),this._z=0);break;case"ZXY":this._x=Math.asin(ot(d,-1,1)),Math.abs(d)<.9999999?(this._y=Math.atan2(-l,f),this._z=Math.atan2(-s,u)):(this._y=0,this._z=Math.atan2(a,n));break;case"ZYX":this._y=Math.asin(-ot(l,-1,1)),Math.abs(l)<.9999999?(this._x=Math.atan2(d,f),this._z=Math.atan2(a,n)):(this._x=0,this._z=Math.atan2(-s,u));break;case"YZX":this._z=Math.asin(ot(a,-1,1)),Math.abs(a)<.9999999?(this._x=Math.atan2(-c,u),this._y=Math.atan2(-l,n)):(this._x=0,this._y=Math.atan2(o,f));break;case"XZY":this._z=Math.asin(-ot(s,-1,1)),Math.abs(s)<.9999999?(this._x=Math.atan2(d,u),this._y=Math.atan2(o,n)):(this._x=Math.atan2(-c,f),this._y=0);break;default:console.warn("THREE.Euler: .setFromRotationMatrix() encountered an unknown order: "+e)}return this._order=e,r===!0&&this._onChangeCallback(),this}setFromQuaternion(t,e,r){return fi.makeRotationFromQuaternion(t),this.setFromRotationMatrix(fi,e,r)}setFromVector3(t,e=this._order){return this.set(t.x,t.y,t.z,e)}reorder(t){return mi.setFromEuler(this),this.setFromQuaternion(mi,t)}equals(t){return t._x===this._x&&t._y===this._y&&t._z===this._z&&t._order===this._order}fromArray(t){return this._x=t[0],this._y=t[1],this._z=t[2],t[3]!==void 0&&(this._order=t[3]),this._onChangeCallback(),this}toArray(t=[],e=0){return t[e]=this._x,t[e+1]=this._y,t[e+2]=this._z,t[e+3]=this._order,t}_onChange(t){return this._onChangeCallback=t,this}_onChangeCallback(){}*[Symbol.iterator](){yield this._x,yield this._y,yield this._z,yield this._order}}Je.DEFAULT_ORDER="XYZ";class ts{constructor(){this.mask=1}set(t){this.mask=(1<<t|0)>>>0}enable(t){this.mask|=1<<t|0}enableAll(){this.mask=-1}toggle(t){this.mask^=1<<t|0}disable(t){this.mask&=~(1<<t|0)}disableAll(){this.mask=0}test(t){return(this.mask&t.mask)!==0}isEnabled(t){return(this.mask&(1<<t|0))!==0}}let es=0;const pi=new y,xe=new Pe,Dt=new Ct,Ke=new y,Re=new y,rs=new y,is=new Pe,yi=new y(1,0,0),xi=new y(0,1,0),gi=new y(0,0,1),wi={type:"added"},ns={type:"removed"},ge={type:"childadded",child:null},Pr={type:"childremoved",child:null};class Zt extends Er{constructor(){super(),this.isObject3D=!0,Object.defineProperty(this,"id",{value:es++}),this.uuid=He(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=Zt.DEFAULT_UP.clone();const t=new y,e=new Je,r=new Pe,i=new y(1,1,1);function n(){r.setFromEuler(e,!1)}function s(){e.setFromQuaternion(r,void 0,!1)}e._onChange(n),r._onChange(s),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:t},rotation:{configurable:!0,enumerable:!0,value:e},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new Ct},normalMatrix:{value:new ce}}),this.matrix=new Ct,this.matrixWorld=new Ct,this.matrixAutoUpdate=Zt.DEFAULT_MATRIX_AUTO_UPDATE,this.matrixWorldAutoUpdate=Zt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE,this.matrixWorldNeedsUpdate=!1,this.layers=new ts,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.animations=[],this.customDepthMaterial=void 0,this.customDistanceMaterial=void 0,this.userData={}}onBeforeShadow(){}onAfterShadow(){}onBeforeRender(){}onAfterRender(){}applyMatrix4(t){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(t),this.matrix.decompose(this.position,this.quaternion,this.scale)}applyQuaternion(t){return this.quaternion.premultiply(t),this}setRotationFromAxisAngle(t,e){this.quaternion.setFromAxisAngle(t,e)}setRotationFromEuler(t){this.quaternion.setFromEuler(t,!0)}setRotationFromMatrix(t){this.quaternion.setFromRotationMatrix(t)}setRotationFromQuaternion(t){this.quaternion.copy(t)}rotateOnAxis(t,e){return xe.setFromAxisAngle(t,e),this.quaternion.multiply(xe),this}rotateOnWorldAxis(t,e){return xe.setFromAxisAngle(t,e),this.quaternion.premultiply(xe),this}rotateX(t){return this.rotateOnAxis(yi,t)}rotateY(t){return this.rotateOnAxis(xi,t)}rotateZ(t){return this.rotateOnAxis(gi,t)}translateOnAxis(t,e){return pi.copy(t).applyQuaternion(this.quaternion),this.position.add(pi.multiplyScalar(e)),this}translateX(t){return this.translateOnAxis(yi,t)}translateY(t){return this.translateOnAxis(xi,t)}translateZ(t){return this.translateOnAxis(gi,t)}localToWorld(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(this.matrixWorld)}worldToLocal(t){return this.updateWorldMatrix(!0,!1),t.applyMatrix4(Dt.copy(this.matrixWorld).invert())}lookAt(t,e,r){t.isVector3?Ke.copy(t):Ke.set(t,e,r);const i=this.parent;this.updateWorldMatrix(!0,!1),Re.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?Dt.lookAt(Re,Ke,this.up):Dt.lookAt(Ke,Re,this.up),this.quaternion.setFromRotationMatrix(Dt),i&&(Dt.extractRotation(i.matrixWorld),xe.setFromRotationMatrix(Dt),this.quaternion.premultiply(xe.invert()))}add(t){if(arguments.length>1){for(let e=0;e<arguments.length;e++)this.add(arguments[e]);return this}return t===this?(console.error("THREE.Object3D.add: object can't be added as a child of itself.",t),this):(t&&t.isObject3D?(t.removeFromParent(),t.parent=this,this.children.push(t),t.dispatchEvent(wi),ge.child=t,this.dispatchEvent(ge),ge.child=null):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",t),this)}remove(t){if(arguments.length>1){for(let r=0;r<arguments.length;r++)this.remove(arguments[r]);return this}const e=this.children.indexOf(t);return e!==-1&&(t.parent=null,this.children.splice(e,1),t.dispatchEvent(ns),Pr.child=t,this.dispatchEvent(Pr),Pr.child=null),this}removeFromParent(){const t=this.parent;return t!==null&&t.remove(this),this}clear(){return this.remove(...this.children)}attach(t){return this.updateWorldMatrix(!0,!1),Dt.copy(this.matrixWorld).invert(),t.parent!==null&&(t.parent.updateWorldMatrix(!0,!1),Dt.multiply(t.parent.matrixWorld)),t.applyMatrix4(Dt),t.removeFromParent(),t.parent=this,this.children.push(t),t.updateWorldMatrix(!1,!0),t.dispatchEvent(wi),ge.child=t,this.dispatchEvent(ge),ge.child=null,this}getObjectById(t){return this.getObjectByProperty("id",t)}getObjectByName(t){return this.getObjectByProperty("name",t)}getObjectByProperty(t,e){if(this[t]===e)return this;for(let r=0,i=this.children.length;r<i;r++){const s=this.children[r].getObjectByProperty(t,e);if(s!==void 0)return s}}getObjectsByProperty(t,e,r=[]){this[t]===e&&r.push(this);const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].getObjectsByProperty(t,e,r);return r}getWorldPosition(t){return this.updateWorldMatrix(!0,!1),t.setFromMatrixPosition(this.matrixWorld)}getWorldQuaternion(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Re,t,rs),t}getWorldScale(t){return this.updateWorldMatrix(!0,!1),this.matrixWorld.decompose(Re,is,t),t}getWorldDirection(t){this.updateWorldMatrix(!0,!1);const e=this.matrixWorld.elements;return t.set(e[8],e[9],e[10]).normalize()}raycast(){}traverse(t){t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverse(t)}traverseVisible(t){if(this.visible===!1)return;t(this);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].traverseVisible(t)}traverseAncestors(t){const e=this.parent;e!==null&&(t(e),e.traverseAncestors(t))}updateMatrix(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0}updateMatrixWorld(t){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||t)&&(this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),this.matrixWorldNeedsUpdate=!1,t=!0);const e=this.children;for(let r=0,i=e.length;r<i;r++)e[r].updateMatrixWorld(t)}updateWorldMatrix(t,e){const r=this.parent;if(t===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.matrixWorldAutoUpdate===!0&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix)),e===!0){const i=this.children;for(let n=0,s=i.length;n<s;n++)i[n].updateWorldMatrix(!1,!0)}}toJSON(t){const e=t===void 0||typeof t=="string",r={};e&&(t={geometries:{},materials:{},textures:{},images:{},shapes:{},skeletons:{},animations:{},nodes:{}},r.metadata={version:4.6,type:"Object",generator:"Object3D.toJSON"});const i={};i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),Object.keys(this.userData).length>0&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),i.up=this.up.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON(),this.instanceColor!==null&&(i.instanceColor=this.instanceColor.toJSON())),this.isBatchedMesh&&(i.type="BatchedMesh",i.perObjectFrustumCulled=this.perObjectFrustumCulled,i.sortObjects=this.sortObjects,i.drawRanges=this._drawRanges,i.reservedRanges=this._reservedRanges,i.visibility=this._visibility,i.active=this._active,i.bounds=this._bounds.map(o=>({boxInitialized:o.boxInitialized,boxMin:o.box.min.toArray(),boxMax:o.box.max.toArray(),sphereInitialized:o.sphereInitialized,sphereRadius:o.sphere.radius,sphereCenter:o.sphere.center.toArray()})),i.maxInstanceCount=this._maxInstanceCount,i.maxVertexCount=this._maxVertexCount,i.maxIndexCount=this._maxIndexCount,i.geometryInitialized=this._geometryInitialized,i.geometryCount=this._geometryCount,i.matricesTexture=this._matricesTexture.toJSON(t),this._colorsTexture!==null&&(i.colorsTexture=this._colorsTexture.toJSON(t)),this.boundingSphere!==null&&(i.boundingSphere={center:i.boundingSphere.center.toArray(),radius:i.boundingSphere.radius}),this.boundingBox!==null&&(i.boundingBox={min:i.boundingBox.min.toArray(),max:i.boundingBox.max.toArray()}));function n(o,a){return o[a.uuid]===void 0&&(o[a.uuid]=a.toJSON(t)),a.uuid}if(this.isScene)this.background&&(this.background.isColor?i.background=this.background.toJSON():this.background.isTexture&&(i.background=this.background.toJSON(t).uuid)),this.environment&&this.environment.isTexture&&this.environment.isRenderTargetTexture!==!0&&(i.environment=this.environment.toJSON(t).uuid);else if(this.isMesh||this.isLine||this.isPoints){i.geometry=n(t.geometries,this.geometry);const o=this.geometry.parameters;if(o!==void 0&&o.shapes!==void 0){const a=o.shapes;if(Array.isArray(a))for(let u=0,c=a.length;u<c;u++){const l=a[u];n(t.shapes,l)}else n(t.shapes,a)}}if(this.isSkinnedMesh&&(i.bindMode=this.bindMode,i.bindMatrix=this.bindMatrix.toArray(),this.skeleton!==void 0&&(n(t.skeletons,this.skeleton),i.skeleton=this.skeleton.uuid)),this.material!==void 0)if(Array.isArray(this.material)){const o=[];for(let a=0,u=this.material.length;a<u;a++)o.push(n(t.materials,this.material[a]));i.material=o}else i.material=n(t.materials,this.material);if(this.children.length>0){i.children=[];for(let o=0;o<this.children.length;o++)i.children.push(this.children[o].toJSON(t).object)}if(this.animations.length>0){i.animations=[];for(let o=0;o<this.animations.length;o++){const a=this.animations[o];i.animations.push(n(t.animations,a))}}if(e){const o=s(t.geometries),a=s(t.materials),u=s(t.textures),c=s(t.images),l=s(t.shapes),d=s(t.skeletons),f=s(t.animations),m=s(t.nodes);o.length>0&&(r.geometries=o),a.length>0&&(r.materials=a),u.length>0&&(r.textures=u),c.length>0&&(r.images=c),l.length>0&&(r.shapes=l),d.length>0&&(r.skeletons=d),f.length>0&&(r.animations=f),m.length>0&&(r.nodes=m)}return r.object=i,r;function s(o){const a=[];for(const u in o){const c=o[u];delete c.metadata,a.push(c)}return a}}clone(t){return new this.constructor().copy(this,t)}copy(t,e=!0){if(this.name=t.name,this.up.copy(t.up),this.position.copy(t.position),this.rotation.order=t.rotation.order,this.quaternion.copy(t.quaternion),this.scale.copy(t.scale),this.matrix.copy(t.matrix),this.matrixWorld.copy(t.matrixWorld),this.matrixAutoUpdate=t.matrixAutoUpdate,this.matrixWorldAutoUpdate=t.matrixWorldAutoUpdate,this.matrixWorldNeedsUpdate=t.matrixWorldNeedsUpdate,this.layers.mask=t.layers.mask,this.visible=t.visible,this.castShadow=t.castShadow,this.receiveShadow=t.receiveShadow,this.frustumCulled=t.frustumCulled,this.renderOrder=t.renderOrder,this.animations=t.animations.slice(),this.userData=JSON.parse(JSON.stringify(t.userData)),e===!0)for(let r=0;r<t.children.length;r++){const i=t.children[r];this.add(i.clone())}return this}}Zt.DEFAULT_UP=new y(0,1,0),Zt.DEFAULT_MATRIX_AUTO_UPDATE=!0,Zt.DEFAULT_MATRIX_WORLD_AUTO_UPDATE=!0;const ht=new y,tr=new Pt;let ss=0;class wt{constructor(t,e,r=!1){if(Array.isArray(t))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.isBufferAttribute=!0,Object.defineProperty(this,"id",{value:ss++}),this.name="",this.array=t,this.itemSize=e,this.count=t!==void 0?t.length/e:0,this.normalized=r,this.usage=ui,this.updateRanges=[],this.gpuType=jn,this.version=0}onUploadCallback(){}set needsUpdate(t){t===!0&&this.version++}setUsage(t){return this.usage=t,this}addUpdateRange(t,e){this.updateRanges.push({start:t,count:e})}clearUpdateRanges(){this.updateRanges.length=0}copy(t){return this.name=t.name,this.array=new t.array.constructor(t.array),this.itemSize=t.itemSize,this.count=t.count,this.normalized=t.normalized,this.usage=t.usage,this.gpuType=t.gpuType,this}copyAt(t,e,r){t*=this.itemSize,r*=e.itemSize;for(let i=0,n=this.itemSize;i<n;i++)this.array[t+i]=e.array[r+i];return this}copyArray(t){return this.array.set(t),this}applyMatrix3(t){if(this.itemSize===2)for(let e=0,r=this.count;e<r;e++)tr.fromBufferAttribute(this,e),tr.applyMatrix3(t),this.setXY(e,tr.x,tr.y);else if(this.itemSize===3)for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.applyMatrix3(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}applyMatrix4(t){for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.applyMatrix4(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}applyNormalMatrix(t){for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.applyNormalMatrix(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}transformDirection(t){for(let e=0,r=this.count;e<r;e++)ht.fromBufferAttribute(this,e),ht.transformDirection(t),this.setXYZ(e,ht.x,ht.y,ht.z);return this}set(t,e=0){return this.array.set(t,e),this}getComponent(t,e){let r=this.array[t*this.itemSize+e];return this.normalized&&(r=Oe(r,this.array)),r}setComponent(t,e,r){return this.normalized&&(r=gt(r,this.array)),this.array[t*this.itemSize+e]=r,this}getX(t){let e=this.array[t*this.itemSize];return this.normalized&&(e=Oe(e,this.array)),e}setX(t,e){return this.normalized&&(e=gt(e,this.array)),this.array[t*this.itemSize]=e,this}getY(t){let e=this.array[t*this.itemSize+1];return this.normalized&&(e=Oe(e,this.array)),e}setY(t,e){return this.normalized&&(e=gt(e,this.array)),this.array[t*this.itemSize+1]=e,this}getZ(t){let e=this.array[t*this.itemSize+2];return this.normalized&&(e=Oe(e,this.array)),e}setZ(t,e){return this.normalized&&(e=gt(e,this.array)),this.array[t*this.itemSize+2]=e,this}getW(t){let e=this.array[t*this.itemSize+3];return this.normalized&&(e=Oe(e,this.array)),e}setW(t,e){return this.normalized&&(e=gt(e,this.array)),this.array[t*this.itemSize+3]=e,this}setXY(t,e,r){return t*=this.itemSize,this.normalized&&(e=gt(e,this.array),r=gt(r,this.array)),this.array[t+0]=e,this.array[t+1]=r,this}setXYZ(t,e,r,i){return t*=this.itemSize,this.normalized&&(e=gt(e,this.array),r=gt(r,this.array),i=gt(i,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this}setXYZW(t,e,r,i,n){return t*=this.itemSize,this.normalized&&(e=gt(e,this.array),r=gt(r,this.array),i=gt(i,this.array),n=gt(n,this.array)),this.array[t+0]=e,this.array[t+1]=r,this.array[t+2]=i,this.array[t+3]=n,this}onUpload(t){return this.onUploadCallback=t,this}clone(){return new this.constructor(this.array,this.itemSize).copy(this)}toJSON(){const t={itemSize:this.itemSize,type:this.array.constructor.name,array:Array.from(this.array),normalized:this.normalized};return this.name!==""&&(t.name=this.name),this.usage!==ui&&(t.usage=this.usage),t}}class os extends wt{constructor(t,e,r){super(new Uint16Array(t),e,r)}}class as extends wt{constructor(t,e,r){super(new Uint32Array(t),e,r)}}class hs extends wt{constructor(t,e,r){super(new Float32Array(t),e,r)}}let us=0;const zt=new Ct,Br=new Zt,we=new y,At=new de,Ie=new de,ut=new y;class er extends Er{constructor(){super(),this.isBufferGeometry=!0,Object.defineProperty(this,"id",{value:us++}),this.uuid=He(),this.name="",this.type="BufferGeometry",this.index=null,this.indirect=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}getIndex(){return this.index}setIndex(t){return Array.isArray(t)?this.index=new(Vn(t)?as:os)(t,1):this.index=t,this}setIndirect(t){return this.indirect=t,this}getIndirect(){return this.indirect}getAttribute(t){return this.attributes[t]}setAttribute(t,e){return this.attributes[t]=e,this}deleteAttribute(t){return delete this.attributes[t],this}hasAttribute(t){return this.attributes[t]!==void 0}addGroup(t,e,r=0){this.groups.push({start:t,count:e,materialIndex:r})}clearGroups(){this.groups=[]}setDrawRange(t,e){this.drawRange.start=t,this.drawRange.count=e}applyMatrix4(t){const e=this.attributes.position;e!==void 0&&(e.applyMatrix4(t),e.needsUpdate=!0);const r=this.attributes.normal;if(r!==void 0){const n=new ce().getNormalMatrix(t);r.applyNormalMatrix(n),r.needsUpdate=!0}const i=this.attributes.tangent;return i!==void 0&&(i.transformDirection(t),i.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this}applyQuaternion(t){return zt.makeRotationFromQuaternion(t),this.applyMatrix4(zt),this}rotateX(t){return zt.makeRotationX(t),this.applyMatrix4(zt),this}rotateY(t){return zt.makeRotationY(t),this.applyMatrix4(zt),this}rotateZ(t){return zt.makeRotationZ(t),this.applyMatrix4(zt),this}translate(t,e,r){return zt.makeTranslation(t,e,r),this.applyMatrix4(zt),this}scale(t,e,r){return zt.makeScale(t,e,r),this.applyMatrix4(zt),this}lookAt(t){return Br.lookAt(t),Br.updateMatrix(),this.applyMatrix4(Br.matrix),this}center(){return this.computeBoundingBox(),this.boundingBox.getCenter(we).negate(),this.translate(we.x,we.y,we.z),this}setFromPoints(t){const e=this.getAttribute("position");if(e===void 0){const r=[];for(let i=0,n=t.length;i<n;i++){const s=t[i];r.push(s.x,s.y,s.z||0)}this.setAttribute("position",new hs(r,3))}else{const r=Math.min(t.length,e.count);for(let i=0;i<r;i++){const n=t[i];e.setXYZ(i,n.x,n.y,n.z||0)}t.length>e.count&&console.warn("THREE.BufferGeometry: Buffer size too small for points data. Use .dispose() and create a new geometry."),e.needsUpdate=!0}return this}computeBoundingBox(){this.boundingBox===null&&(this.boundingBox=new de);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingBox(): GLBufferAttribute requires a manual bounding box.",this),this.boundingBox.set(new y(-1/0,-1/0,-1/0),new y(1/0,1/0,1/0));return}if(t!==void 0){if(this.boundingBox.setFromBufferAttribute(t),e)for(let r=0,i=e.length;r<i;r++){const n=e[r];At.setFromBufferAttribute(n),this.morphTargetsRelative?(ut.addVectors(this.boundingBox.min,At.min),this.boundingBox.expandByPoint(ut),ut.addVectors(this.boundingBox.max,At.max),this.boundingBox.expandByPoint(ut)):(this.boundingBox.expandByPoint(At.min),this.boundingBox.expandByPoint(At.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox(): Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)}computeBoundingSphere(){this.boundingSphere===null&&(this.boundingSphere=new Or);const t=this.attributes.position,e=this.morphAttributes.position;if(t&&t.isGLBufferAttribute){console.error("THREE.BufferGeometry.computeBoundingSphere(): GLBufferAttribute requires a manual bounding sphere.",this),this.boundingSphere.set(new y,1/0);return}if(t){const r=this.boundingSphere.center;if(At.setFromBufferAttribute(t),e)for(let n=0,s=e.length;n<s;n++){const o=e[n];Ie.setFromBufferAttribute(o),this.morphTargetsRelative?(ut.addVectors(At.min,Ie.min),At.expandByPoint(ut),ut.addVectors(At.max,Ie.max),At.expandByPoint(ut)):(At.expandByPoint(Ie.min),At.expandByPoint(Ie.max))}At.getCenter(r);let i=0;for(let n=0,s=t.count;n<s;n++)ut.fromBufferAttribute(t,n),i=Math.max(i,r.distanceToSquared(ut));if(e)for(let n=0,s=e.length;n<s;n++){const o=e[n],a=this.morphTargetsRelative;for(let u=0,c=o.count;u<c;u++)ut.fromBufferAttribute(o,u),a&&(we.fromBufferAttribute(t,u),ut.add(we)),i=Math.max(i,r.distanceToSquared(ut))}this.boundingSphere.radius=Math.sqrt(i),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}}computeTangents(){const t=this.index,e=this.attributes;if(t===null||e.position===void 0||e.normal===void 0||e.uv===void 0){console.error("THREE.BufferGeometry: .computeTangents() failed. Missing required attributes (index, position, normal or uv)");return}const r=e.position,i=e.normal,n=e.uv;this.hasAttribute("tangent")===!1&&this.setAttribute("tangent",new wt(new Float32Array(4*r.count),4));const s=this.getAttribute("tangent"),o=[],a=[];for(let U=0;U<r.count;U++)o[U]=new y,a[U]=new y;const u=new y,c=new y,l=new y,d=new Pt,f=new Pt,m=new Pt,p=new y,A=new y;function b(U,Q,st){u.fromBufferAttribute(r,U),c.fromBufferAttribute(r,Q),l.fromBufferAttribute(r,st),d.fromBufferAttribute(n,U),f.fromBufferAttribute(n,Q),m.fromBufferAttribute(n,st),c.sub(u),l.sub(u),f.sub(d),m.sub(d);const et=1/(f.x*m.y-m.x*f.y);isFinite(et)&&(p.copy(c).multiplyScalar(m.y).addScaledVector(l,-f.y).multiplyScalar(et),A.copy(l).multiplyScalar(f.x).addScaledVector(c,-m.x).multiplyScalar(et),o[U].add(p),o[Q].add(p),o[st].add(p),a[U].add(A),a[Q].add(A),a[st].add(A))}let P=this.groups;P.length===0&&(P=[{start:0,count:t.count}]);for(let U=0,Q=P.length;U<Q;++U){const st=P[U],et=st.start,kt=st.count;for(let dt=et,St=et+kt;dt<St;dt+=3)b(t.getX(dt+0),t.getX(dt+1),t.getX(dt+2))}const B=new y,L=new y,S=new y,q=new y;function C(U){S.fromBufferAttribute(i,U),q.copy(S);const Q=o[U];B.copy(Q),B.sub(S.multiplyScalar(S.dot(Q))).normalize(),L.crossVectors(q,Q);const et=L.dot(a[U])<0?-1:1;s.setXYZW(U,B.x,B.y,B.z,et)}for(let U=0,Q=P.length;U<Q;++U){const st=P[U],et=st.start,kt=st.count;for(let dt=et,St=et+kt;dt<St;dt+=3)C(t.getX(dt+0)),C(t.getX(dt+1)),C(t.getX(dt+2))}}computeVertexNormals(){const t=this.index,e=this.getAttribute("position");if(e!==void 0){let r=this.getAttribute("normal");if(r===void 0)r=new wt(new Float32Array(e.count*3),3),this.setAttribute("normal",r);else for(let d=0,f=r.count;d<f;d++)r.setXYZ(d,0,0,0);const i=new y,n=new y,s=new y,o=new y,a=new y,u=new y,c=new y,l=new y;if(t)for(let d=0,f=t.count;d<f;d+=3){const m=t.getX(d+0),p=t.getX(d+1),A=t.getX(d+2);i.fromBufferAttribute(e,m),n.fromBufferAttribute(e,p),s.fromBufferAttribute(e,A),c.subVectors(s,n),l.subVectors(i,n),c.cross(l),o.fromBufferAttribute(r,m),a.fromBufferAttribute(r,p),u.fromBufferAttribute(r,A),o.add(c),a.add(c),u.add(c),r.setXYZ(m,o.x,o.y,o.z),r.setXYZ(p,a.x,a.y,a.z),r.setXYZ(A,u.x,u.y,u.z)}else for(let d=0,f=e.count;d<f;d+=3)i.fromBufferAttribute(e,d+0),n.fromBufferAttribute(e,d+1),s.fromBufferAttribute(e,d+2),c.subVectors(s,n),l.subVectors(i,n),c.cross(l),r.setXYZ(d+0,c.x,c.y,c.z),r.setXYZ(d+1,c.x,c.y,c.z),r.setXYZ(d+2,c.x,c.y,c.z);this.normalizeNormals(),r.needsUpdate=!0}}normalizeNormals(){const t=this.attributes.normal;for(let e=0,r=t.count;e<r;e++)ut.fromBufferAttribute(t,e),ut.normalize(),t.setXYZ(e,ut.x,ut.y,ut.z)}toNonIndexed(){function t(o,a){const u=o.array,c=o.itemSize,l=o.normalized,d=new u.constructor(a.length*c);let f=0,m=0;for(let p=0,A=a.length;p<A;p++){o.isInterleavedBufferAttribute?f=a[p]*o.data.stride+o.offset:f=a[p]*c;for(let b=0;b<c;b++)d[m++]=u[f++]}return new wt(d,c,l)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): BufferGeometry is already non-indexed."),this;const e=new er,r=this.index.array,i=this.attributes;for(const o in i){const a=i[o],u=t(a,r);e.setAttribute(o,u)}const n=this.morphAttributes;for(const o in n){const a=[],u=n[o];for(let c=0,l=u.length;c<l;c++){const d=u[c],f=t(d,r);a.push(f)}e.morphAttributes[o]=a}e.morphTargetsRelative=this.morphTargetsRelative;const s=this.groups;for(let o=0,a=s.length;o<a;o++){const u=s[o];e.addGroup(u.start,u.count,u.materialIndex)}return e}toJSON(){const t={metadata:{version:4.6,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(t.uuid=this.uuid,t.type=this.type,this.name!==""&&(t.name=this.name),Object.keys(this.userData).length>0&&(t.userData=this.userData),this.parameters!==void 0){const a=this.parameters;for(const u in a)a[u]!==void 0&&(t[u]=a[u]);return t}t.data={attributes:{}};const e=this.index;e!==null&&(t.data.index={type:e.array.constructor.name,array:Array.prototype.slice.call(e.array)});const r=this.attributes;for(const a in r){const u=r[a];t.data.attributes[a]=u.toJSON(t.data)}const i={};let n=!1;for(const a in this.morphAttributes){const u=this.morphAttributes[a],c=[];for(let l=0,d=u.length;l<d;l++){const f=u[l];c.push(f.toJSON(t.data))}c.length>0&&(i[a]=c,n=!0)}n&&(t.data.morphAttributes=i,t.data.morphTargetsRelative=this.morphTargetsRelative);const s=this.groups;s.length>0&&(t.data.groups=JSON.parse(JSON.stringify(s)));const o=this.boundingSphere;return o!==null&&(t.data.boundingSphere={center:o.center.toArray(),radius:o.radius}),t}clone(){return new this.constructor().copy(this)}copy(t){this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null;const e={};this.name=t.name;const r=t.index;r!==null&&this.setIndex(r.clone());const i=t.attributes;for(const u in i){const c=i[u];this.setAttribute(u,c.clone(e))}const n=t.morphAttributes;for(const u in n){const c=[],l=n[u];for(let d=0,f=l.length;d<f;d++)c.push(l[d].clone(e));this.morphAttributes[u]=c}this.morphTargetsRelative=t.morphTargetsRelative;const s=t.groups;for(let u=0,c=s.length;u<c;u++){const l=s[u];this.addGroup(l.start,l.count,l.materialIndex)}const o=t.boundingBox;o!==null&&(this.boundingBox=o.clone());const a=t.boundingSphere;return a!==null&&(this.boundingSphere=a.clone()),this.drawRange.start=t.drawRange.start,this.drawRange.count=t.drawRange.count,this.userData=t.userData,this}dispose(){this.dispatchEvent({type:"dispose"})}}typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:si}})),typeof window<"u"&&(window.__THREE__?console.warn("WARNING: Multiple instances of Three.js being imported."):window.__THREE__=si);const cs=new y;function bi(h,t,e=new y,r){const{x:i,y:n,z:s}=h,o=t.x,a=t.y,u=t.z,c=i*i*o,l=n*n*a,d=s*s*u,f=c+l+d,m=Math.sqrt(1/f);if(!Number.isFinite(m))return;const p=cs.copy(h).multiplyScalar(m);if(f<((r==null?void 0:r.centerTolerance)??.1))return e.copy(p);const A=p.multiply(t).multiplyScalar(2);let b=(1-m)*h.length()/(A.length()/2),P=0,B,L,S,q;do{b-=P,B=1/(1+b*o),L=1/(1+b*a),S=1/(1+b*u);const C=B*B,U=L*L,Q=S*S,st=C*B,et=U*L,kt=Q*S;q=c*C+l*U+d*Q-1,P=q/((c*st*o+l*et*a+d*kt*u)*-2)}while(Math.abs(q)>1e-12);return e.set(i*B,n*L,s*S)}const rr=new y,_i=new y,Mi=new y,Cr=class{constructor(t,e,r){this.radii=new y(t,e,r)}get minimumRadius(){return Math.min(this.radii.x,this.radii.y,this.radii.z)}get maximumRadius(){return Math.max(this.radii.x,this.radii.y,this.radii.z)}reciprocalRadii(t=new y){const{x:e,y:r,z:i}=this.radii;return t.set(1/e,1/r,1/i)}reciprocalRadiiSquared(t=new y){const{x:e,y:r,z:i}=this.radii;return t.set(1/e**2,1/r**2,1/i**2)}projectOnSurface(t,e=new y,r){return bi(t,this.reciprocalRadiiSquared(),e,r)}getSurfaceNormal(t,e=new y){return e.multiplyVectors(this.reciprocalRadiiSquared(rr),t).normalize()}getEastNorthUpVectors(t,e=new y,r=new y,i=new y){this.getSurfaceNormal(t,i),e.set(-t.y,t.x,0).normalize(),r.crossVectors(i,e).normalize()}getEastNorthUpFrame(t,e=new Ct){const r=rr,i=_i,n=Mi;return this.getEastNorthUpVectors(t,r,i,n),e.makeBasis(r,i,n).setPosition(t)}getIntersection(t,e=new y){const r=this.reciprocalRadii(rr),i=_i.copy(r).multiply(t.origin),n=Mi.copy(r).multiply(t.direction),s=i.lengthSq(),o=n.lengthSq(),a=i.dot(n),u=a**2-o*(s-1);if(s===1)return e.copy(t.origin);if(s>1){if(a>=0||u<0)return;const c=Math.sqrt(u),l=(-a-c)/o,d=(-a+c)/o;return t.at(Math.min(l,d),e)}if(s<1){const c=a**2-o*(s-1),l=Math.sqrt(c),d=(-a+l)/o;return t.at(d,e)}if(a<0)return t.at(-a/o,e)}getOsculatingSphereCenter(t,e,r=new y){const i=this.radii.x**2,n=rr.set(t.x/i,t.y/i,t.z/this.radii.z**2).normalize();return r.copy(n.multiplyScalar(-e).add(t))}};Cr.WGS84=new Cr(6378137,6378137,6356752314245179e-9);let Ei=Cr;const ir=new y,Ai=new y,Ne=class ri{constructor(t=0,e=0,r=0){this.longitude=t,this.latitude=e,this.height=r}set(t,e,r){return this.longitude=t,this.latitude=e,r!=null&&(this.height=r),this}clone(){return new ri(this.longitude,this.latitude,this.height)}copy(t){return this.longitude=t.longitude,this.latitude=t.latitude,this.height=t.height,this}equals(t){return t.longitude===this.longitude&&t.latitude===this.latitude&&t.height===this.height}setLongitude(t){return this.longitude=t,this}setLatitude(t){return this.latitude=t,this}setHeight(t){return this.height=t,this}normalize(){return this.longitude<ri.MIN_LONGITUDE&&(this.longitude+=Math.PI*2),this}setFromECEF(t,e){const r=((e==null?void 0:e.ellipsoid)??Ei.WGS84).reciprocalRadiiSquared(ir),i=bi(t,r,Ai,e);if(i==null)throw new Error(`Could not project position to ellipsoid surface: ${t.toArray()}`);const n=ir.multiplyVectors(i,r).normalize();this.longitude=Math.atan2(n.y,n.x),this.latitude=Math.asin(n.z);const s=ir.subVectors(t,i);return this.height=Math.sign(s.dot(t))*s.length(),this}toECEF(t=new y,e){const r=(e==null?void 0:e.ellipsoid)??Ei.WGS84,i=ir.multiplyVectors(r.radii,r.radii),n=Math.cos(this.latitude),s=Ai.set(n*Math.cos(this.longitude),n*Math.sin(this.longitude),Math.sin(this.latitude)).normalize();return t.multiplyVectors(i,s),t.divideScalar(Math.sqrt(s.dot(t))).add(s.multiplyScalar(this.height))}fromArray(t,e=0){return this.longitude=t[e],this.latitude=t[e+1],this.height=t[e+2],this}toArray(t=[],e=0){return t[e]=this.longitude,t[e+1]=this.latitude,t[e+2]=this.height,t}*[Symbol.iterator](){yield this.longitude,yield this.latitude,yield this.height}};Ne.MIN_LONGITUDE=-Math.PI,Ne.MAX_LONGITUDE=Math.PI,Ne.MIN_LATITUDE=-Math.PI/2,Ne.MAX_LATITUDE=Math.PI/2;let be=Ne;function vi(h){var t;const{attributes:e,index:r,boundingBox:i,boundingSphere:n}=h;return[{attributes:e,index:r,boundingBox:i,boundingSphere:n},[...Object.values(h.attributes).map(s=>s.array.buffer),(t=h.index)==null?void 0:t.array.buffer].filter(s=>s!=null)]}function ls(h,t=new er){for(const[e,r]of Object.entries(h.attributes))t.setAttribute(e,new wt(r.array,r.itemSize,r.normalized));if(t.index=h.index!=null?new wt(h.index.array,h.index.itemSize,h.index.normalized):null,h.boundingBox!=null){const{min:e,max:r}=h.boundingBox;t.boundingBox=new de(new y(e.x,e.y,e.z),new y(r.x,r.y,r.z))}if(h.boundingSphere!=null){const{center:e,radius:r}=h.boundingSphere;t.boundingSphere=new Or(new y(e.x,e.y,e.z),r)}return t}const ds="This is not an object",fs="This is not a Float16Array object",ki="This constructor is not a subclass of Float16Array",zi="The constructor property value is not an object",ms="Species constructor didn't return TypedArray object",ps="Derived constructor created TypedArray object which was too small length",Ue="Attempting to access detached ArrayBuffer",Rr="Cannot convert undefined or null to object",Ir="Cannot mix BigInt and other types, use explicit conversions",Si="@@iterator property is not callable",Ti="Reduce of empty array with no initial value",ys="The comparison function must be either a function or undefined",Nr="Offset is out of bounds";function K(h){return(t,...e)=>bt(h,t,e)}function _e(h,t){return K(Me(h,t).get)}const{apply:bt,construct:We,defineProperty:xs,get:Ur,getOwnPropertyDescriptor:Me,getPrototypeOf:Le,has:Wr,ownKeys:Oi,set:Pi,setPrototypeOf:Bi}=Reflect,gs=Proxy,{EPSILON:ws,MAX_SAFE_INTEGER:Ci,isFinite:Ri,isNaN:Ee}=Number,{iterator:Wt,species:bs,toStringTag:Lr,for:_s}=Symbol,Ae=Object,{create:nr,defineProperty:Fe,freeze:Ms,is:Ii}=Ae,Fr=Ae.prototype,Es=Fr.__lookupGetter__?K(Fr.__lookupGetter__):(h,t)=>{if(h==null)throw it(Rr);let e=Ae(h);do{const r=Me(e,t);if(r!==void 0)return qt(r,"get")?r.get:void 0}while((e=Le(e))!==null)},qt=Ae.hasOwn||K(Fr.hasOwnProperty),Ni=Array,Ui=Ni.isArray,sr=Ni.prototype,As=K(sr.join),vs=K(sr.push),ks=K(sr.toLocaleString),jr=sr[Wt],zs=K(jr),{abs:Ss,trunc:Wi}=Math,or=ArrayBuffer,Ts=or.isView,Li=or.prototype,Os=K(Li.slice),Ps=_e(Li,"byteLength"),Dr=typeof SharedArrayBuffer<"u"?SharedArrayBuffer:null,Bs=Dr&&_e(Dr.prototype,"byteLength"),qr=Le(Uint8Array),Cs=qr.from,ct=qr.prototype,Rs=ct[Wt],Is=K(ct.keys),Ns=K(ct.values),Us=K(ct.entries),Ws=K(ct.set),Fi=K(ct.reverse),Ls=K(ct.fill),Fs=K(ct.copyWithin),ji=K(ct.sort),je=K(ct.slice),js=K(ct.subarray),lt=_e(ct,"buffer"),ie=_e(ct,"byteOffset"),H=_e(ct,"length"),Di=_e(ct,Lr),Ds=Uint8Array,vt=Uint16Array,qi=(...h)=>bt(Cs,vt,h),Yr=Uint32Array,qs=Float32Array,ne=Le([][Wt]()),ar=K(ne.next),Ys=K(function*(){}().next),Xs=Le(ne),it=TypeError,Xr=RangeError,Yi=WeakSet,Xi=Yi.prototype,Vs=K(Xi.add),Hs=K(Xi.has),hr=WeakMap,Vr=hr.prototype,ur=K(Vr.get),Zs=K(Vr.has),Hr=K(Vr.set),Vi=new hr,$s=nr(null,{next:{value:function(){const h=ur(Vi,this);return ar(h)}},[Wt]:{value:function(){return this}}});function cr(h){if(h[Wt]===jr&&ne.next===ar)return h;const t=nr($s);return Hr(Vi,t,zs(h)),t}const Hi=new hr,Zi=nr(Xs,{next:{value:function(){const h=ur(Hi,this);return Ys(h)},writable:!0,configurable:!0}});for(const h of Oi(ne))h!=="next"&&Fe(Zi,h,Me(ne,h));function $i(h){const t=nr(Zi);return Hr(Hi,t,h),t}function lr(h){return h!==null&&typeof h=="object"||typeof h=="function"}function Gi(h){return h!==null&&typeof h=="object"}function dr(h){return Di(h)!==void 0}function Zr(h){const t=Di(h);return t==="BigInt64Array"||t==="BigUint64Array"}function Gs(h){try{return Ui(h)?!1:(Ps(h),!0)}catch{return!1}}function Qi(h){if(Dr===null)return!1;try{return Bs(h),!0}catch{return!1}}function Qs(h){return Gs(h)||Qi(h)}function Ji(h){return Ui(h)?h[Wt]===jr&&ne.next===ar:!1}function Js(h){return dr(h)?h[Wt]===Rs&&ne.next===ar:!1}function fr(h){if(typeof h!="string")return!1;const t=+h;return h!==t+""||!Ri(t)?!1:t===Wi(t)}const mr=_s("__Float16Array__");function Ks(h){if(!Gi(h))return!1;const t=Le(h);if(!Gi(t))return!1;const e=t.constructor;if(e===void 0)return!1;if(!lr(e))throw it(zi);return Wr(e,mr)}const $r=1/ws;function to(h){return h+$r-$r}const Ki=6103515625e-14,eo=65504,tn=.0009765625,en=tn*Ki,ro=tn*$r;function io(h){const t=+h;if(!Ri(t)||t===0)return t;const e=t>0?1:-1,r=Ss(t);if(r<Ki)return e*to(r/en)*en;const i=(1+ro)*r,n=i-(i-r);return n>eo||Ee(n)?e*(1/0):e*n}const rn=new or(4),nn=new qs(rn),sn=new Yr(rn),It=new vt(512),Nt=new Ds(512);for(let h=0;h<256;++h){const t=h-127;t<-24?(It[h]=0,It[h|256]=32768,Nt[h]=24,Nt[h|256]=24):t<-14?(It[h]=1024>>-t-14,It[h|256]=1024>>-t-14|32768,Nt[h]=-t-1,Nt[h|256]=-t-1):t<=15?(It[h]=t+15<<10,It[h|256]=t+15<<10|32768,Nt[h]=13,Nt[h|256]=13):t<128?(It[h]=31744,It[h|256]=64512,Nt[h]=24,Nt[h|256]=24):(It[h]=31744,It[h|256]=64512,Nt[h]=13,Nt[h|256]=13)}function Lt(h){nn[0]=io(h);const t=sn[0],e=t>>23&511;return It[e]+((t&8388607)>>Nt[e])}const Gr=new Yr(2048);for(let h=1;h<1024;++h){let t=h<<13,e=0;for(;(t&8388608)===0;)t<<=1,e-=8388608;t&=-8388609,e+=947912704,Gr[h]=t|e}for(let h=1024;h<2048;++h)Gr[h]=939524096+(h-1024<<13);const ve=new Yr(64);for(let h=1;h<31;++h)ve[h]=h<<23;ve[31]=1199570944,ve[32]=2147483648;for(let h=33;h<63;++h)ve[h]=2147483648+(h-32<<23);ve[63]=3347054592;const on=new vt(64);for(let h=1;h<64;++h)h!==32&&(on[h]=1024);function G(h){const t=h>>10;return sn[0]=Gr[on[t]+(h&1023)]+ve[t],nn[0]}function Yt(h){const t=+h;return Ee(t)||t===0?0:Wi(t)}function Qr(h){const t=Yt(h);return t<0?0:t<Ci?t:Ci}function pr(h,t){if(!lr(h))throw it(ds);const e=h.constructor;if(e===void 0)return t;if(!lr(e))throw it(zi);return e[bs]??t}function De(h){if(Qi(h))return!1;try{return Os(h,0,0),!1}catch{}return!0}function an(h,t){const e=Ee(h),r=Ee(t);if(e&&r)return 0;if(e)return 1;if(r||h<t)return-1;if(h>t)return 1;if(h===0&&t===0){const i=Ii(h,0),n=Ii(t,0);if(!i&&n)return-1;if(i&&!n)return 1}return 0}const Jr=2,yr=new hr;function ke(h){return Zs(yr,h)||!Ts(h)&&Ks(h)}function Z(h){if(!ke(h))throw it(fs)}function xr(h,t){const e=ke(h),r=dr(h);if(!e&&!r)throw it(ms);if(typeof t=="number"){let i;if(e){const n=N(h);i=H(n)}else i=H(h);if(i<t)throw it(ps)}if(Zr(h))throw it(Ir)}function N(h){const t=ur(yr,h);if(t!==void 0){const i=lt(t);if(De(i))throw it(Ue);return t}const e=h.buffer;if(De(e))throw it(Ue);const r=We(nt,[e,h.byteOffset,h.length],h.constructor);return ur(yr,r)}function hn(h){const t=H(h),e=[];for(let r=0;r<t;++r)e[r]=G(h[r]);return e}const un=new Yi;for(const h of Oi(ct)){if(h===Lr)continue;const t=Me(ct,h);qt(t,"get")&&typeof t.get=="function"&&Vs(un,t.get)}const no=Ms({get(h,t,e){return fr(t)&&qt(h,t)?G(Ur(h,t)):Hs(un,Es(h,t))?Ur(h,t):Ur(h,t,e)},set(h,t,e,r){return fr(t)&&qt(h,t)?Pi(h,t,Lt(e)):Pi(h,t,e,r)},getOwnPropertyDescriptor(h,t){if(fr(t)&&qt(h,t)){const e=Me(h,t);return e.value=G(e.value),e}return Me(h,t)},defineProperty(h,t,e){return fr(t)&&qt(h,t)&&qt(e,"value")&&(e.value=Lt(e.value)),xs(h,t,e)}});class nt{constructor(t,e,r){let i;if(ke(t))i=We(vt,[N(t)],new.target);else if(lr(t)&&!Qs(t)){let s,o;if(dr(t)){s=t,o=H(t);const a=lt(t);if(De(a))throw it(Ue);if(Zr(t))throw it(Ir);const u=new or(o*Jr);i=We(vt,[u],new.target)}else{const a=t[Wt];if(a!=null&&typeof a!="function")throw it(Si);a!=null?Ji(t)?(s=t,o=t.length):(s=[...t],o=s.length):(s=t,o=Qr(s.length)),i=We(vt,[o],new.target)}for(let a=0;a<o;++a)i[a]=Lt(s[a])}else i=We(vt,arguments,new.target);const n=new gs(i,no);return Hr(yr,n,i),n}static from(t,...e){const r=this;if(!Wr(r,mr))throw it(ki);if(r===nt){if(ke(t)&&e.length===0){const c=N(t),l=new vt(lt(c),ie(c),H(c));return new nt(lt(je(l)))}if(e.length===0)return new nt(lt(qi(t,Lt)));const a=e[0],u=e[1];return new nt(lt(qi(t,function(c,...l){return Lt(bt(a,this,[c,...cr(l)]))},u)))}let i,n;const s=t[Wt];if(s!=null&&typeof s!="function")throw it(Si);if(s!=null)Ji(t)?(i=t,n=t.length):Js(t)?(i=t,n=H(t)):(i=[...t],n=i.length);else{if(t==null)throw it(Rr);i=Ae(t),n=Qr(i.length)}const o=new r(n);if(e.length===0)for(let a=0;a<n;++a)o[a]=i[a];else{const a=e[0],u=e[1];for(let c=0;c<n;++c)o[c]=bt(a,u,[i[c],c])}return o}static of(...t){const e=this;if(!Wr(e,mr))throw it(ki);const r=t.length;if(e===nt){const n=new nt(r),s=N(n);for(let o=0;o<r;++o)s[o]=Lt(t[o]);return n}const i=new e(r);for(let n=0;n<r;++n)i[n]=t[n];return i}keys(){Z(this);const t=N(this);return Is(t)}values(){Z(this);const t=N(this);return $i(function*(){for(const e of Ns(t))yield G(e)}())}entries(){Z(this);const t=N(this);return $i(function*(){for(const[e,r]of Us(t))yield[e,G(r)]}())}at(t){Z(this);const e=N(this),r=H(e),i=Yt(t),n=i>=0?i:r+i;if(!(n<0||n>=r))return G(e[n])}with(t,e){Z(this);const r=N(this),i=H(r),n=Yt(t),s=n>=0?n:i+n,o=+e;if(s<0||s>=i)throw Xr(Nr);const a=new vt(lt(r),ie(r),H(r)),u=new nt(lt(je(a))),c=N(u);return c[s]=Lt(o),u}map(t,...e){Z(this);const r=N(this),i=H(r),n=e[0],s=pr(r,nt);if(s===nt){const a=new nt(i),u=N(a);for(let c=0;c<i;++c){const l=G(r[c]);u[c]=Lt(bt(t,n,[l,c,this]))}return a}const o=new s(i);xr(o,i);for(let a=0;a<i;++a){const u=G(r[a]);o[a]=bt(t,n,[u,a,this])}return o}filter(t,...e){Z(this);const r=N(this),i=H(r),n=e[0],s=[];for(let u=0;u<i;++u){const c=G(r[u]);bt(t,n,[c,u,this])&&vs(s,c)}const o=pr(r,nt),a=new o(s);return xr(a),a}reduce(t,...e){Z(this);const r=N(this),i=H(r);if(i===0&&e.length===0)throw it(Ti);let n,s;e.length===0?(n=G(r[0]),s=1):(n=e[0],s=0);for(let o=s;o<i;++o)n=t(n,G(r[o]),o,this);return n}reduceRight(t,...e){Z(this);const r=N(this),i=H(r);if(i===0&&e.length===0)throw it(Ti);let n,s;e.length===0?(n=G(r[i-1]),s=i-2):(n=e[0],s=i-1);for(let o=s;o>=0;--o)n=t(n,G(r[o]),o,this);return n}forEach(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=0;s<i;++s)bt(t,n,[G(r[s]),s,this])}find(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=0;s<i;++s){const o=G(r[s]);if(bt(t,n,[o,s,this]))return o}}findIndex(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=0;s<i;++s){const o=G(r[s]);if(bt(t,n,[o,s,this]))return s}return-1}findLast(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=i-1;s>=0;--s){const o=G(r[s]);if(bt(t,n,[o,s,this]))return o}}findLastIndex(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=i-1;s>=0;--s){const o=G(r[s]);if(bt(t,n,[o,s,this]))return s}return-1}every(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=0;s<i;++s)if(!bt(t,n,[G(r[s]),s,this]))return!1;return!0}some(t,...e){Z(this);const r=N(this),i=H(r),n=e[0];for(let s=0;s<i;++s)if(bt(t,n,[G(r[s]),s,this]))return!0;return!1}set(t,...e){Z(this);const r=N(this),i=Yt(e[0]);if(i<0)throw Xr(Nr);if(t==null)throw it(Rr);if(Zr(t))throw it(Ir);if(ke(t))return Ws(N(this),N(t),i);if(dr(t)){const a=lt(t);if(De(a))throw it(Ue)}const n=H(r),s=Ae(t),o=Qr(s.length);if(i===1/0||o+i>n)throw Xr(Nr);for(let a=0;a<o;++a)r[a+i]=Lt(s[a])}reverse(){Z(this);const t=N(this);return Fi(t),this}toReversed(){Z(this);const t=N(this),e=new vt(lt(t),ie(t),H(t)),r=new nt(lt(je(e))),i=N(r);return Fi(i),r}fill(t,...e){Z(this);const r=N(this);return Ls(r,Lt(t),...cr(e)),this}copyWithin(t,e,...r){Z(this);const i=N(this);return Fs(i,t,e,...cr(r)),this}sort(t){Z(this);const e=N(this),r=t!==void 0?t:an;return ji(e,(i,n)=>r(G(i),G(n))),this}toSorted(t){Z(this);const e=N(this);if(t!==void 0&&typeof t!="function")throw new it(ys);const r=t!==void 0?t:an,i=new vt(lt(e),ie(e),H(e)),n=new nt(lt(je(i))),s=N(n);return ji(s,(o,a)=>r(G(o),G(a))),n}slice(t,e){Z(this);const r=N(this),i=pr(r,nt);if(i===nt){const m=new vt(lt(r),ie(r),H(r));return new nt(lt(je(m,t,e)))}const n=H(r),s=Yt(t),o=e===void 0?n:Yt(e);let a;s===-1/0?a=0:s<0?a=n+s>0?n+s:0:a=n<s?n:s;let u;o===-1/0?u=0:o<0?u=n+o>0?n+o:0:u=n<o?n:o;const c=u-a>0?u-a:0,l=new i(c);if(xr(l,c),c===0)return l;const d=lt(r);if(De(d))throw it(Ue);let f=0;for(;a<u;)l[f]=G(r[a]),++a,++f;return l}subarray(t,e){Z(this);const r=N(this),i=pr(r,nt),n=new vt(lt(r),ie(r),H(r)),s=js(n,t,e),o=new i(lt(s),ie(s),H(s));return xr(o),o}indexOf(t,...e){Z(this);const r=N(this),i=H(r);let n=Yt(e[0]);if(n===1/0)return-1;n<0&&(n+=i,n<0&&(n=0));for(let s=n;s<i;++s)if(qt(r,s)&&G(r[s])===t)return s;return-1}lastIndexOf(t,...e){Z(this);const r=N(this),i=H(r);let n=e.length>=1?Yt(e[0]):i-1;if(n===-1/0)return-1;n>=0?n=n<i-1?n:i-1:n+=i;for(let s=n;s>=0;--s)if(qt(r,s)&&G(r[s])===t)return s;return-1}includes(t,...e){Z(this);const r=N(this),i=H(r);let n=Yt(e[0]);if(n===1/0)return!1;n<0&&(n+=i,n<0&&(n=0));const s=Ee(t);for(let o=n;o<i;++o){const a=G(r[o]);if(s&&Ee(a)||a===t)return!0}return!1}join(t){Z(this);const e=N(this),r=hn(e);return As(r,t)}toLocaleString(...t){Z(this);const e=N(this),r=hn(e);return ks(r,...cr(t))}get[Lr](){if(ke(this))return"Float16Array"}}Fe(nt,"BYTES_PER_ELEMENT",{value:Jr}),Fe(nt,mr,{}),Bi(nt,qr);const gr=nt.prototype;Fe(gr,"BYTES_PER_ELEMENT",{value:Jr}),Fe(gr,Wt,{value:gr.values,writable:!0,configurable:!0}),Bi(gr,ct);const Kr=Xn.lerp;var qe=Uint8Array,cn=Uint16Array,so=Uint32Array,oo=new qe([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),ao=new qe([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),ln=function(h,t){for(var e=new cn(31),r=0;r<31;++r)e[r]=t+=1<<h[r-1];for(var i=new so(e[30]),r=1;r<30;++r)for(var n=e[r];n<e[r+1];++n)i[n]=n-e[r]<<5|r;return[e,i]},dn=ln(oo,2),ho=dn[0],uo=dn[1];ho[28]=258,uo[258]=28,ln(ao,0);for(var co=new cn(32768),tt=0;tt<32768;++tt){var $t=(tt&43690)>>>1|(tt&21845)<<1;$t=($t&52428)>>>2|($t&13107)<<2,$t=($t&61680)>>>4|($t&3855)<<4,co[tt]=(($t&65280)>>>8|($t&255)<<8)>>>1}for(var wr=new qe(288),tt=0;tt<144;++tt)wr[tt]=8;for(var tt=144;tt<256;++tt)wr[tt]=9;for(var tt=256;tt<280;++tt)wr[tt]=7;for(var tt=280;tt<288;++tt)wr[tt]=8;for(var lo=new qe(32),tt=0;tt<32;++tt)lo[tt]=5;var fo=new qe(0),mo=typeof TextDecoder<"u"&&new TextDecoder,po=0;try{mo.decode(fo,{stream:!0}),po=1}catch{}const ti=class _n{constructor(t=0,e=0,r=0,i=0){this.west=t,this.south=e,this.east=r,this.north=i}get width(){let t=this.east;return t<this.west&&(t+=Math.PI*2),t-this.west}get height(){return this.north-this.south}set(t,e,r,i){return this.west=t,this.south=e,this.east=r,this.north=i,this}clone(){return new _n(this.west,this.south,this.east,this.north)}copy(t){return this.west=t.west,this.south=t.south,this.east=t.east,this.north=t.north,this}equals(t){return t.west===this.west&&t.south===this.south&&t.east===this.east&&t.north===this.north}at(t,e,r=new be){return r.set(this.west+(this.east-this.west)*t,this.north+(this.south-this.north)*e)}fromArray(t,e=0){return this.west=t[e],this.south=t[e+1],this.east=t[e+2],this.north=t[e+3],this}toArray(t=[],e=0){return t[e]=this.west,t[e+1]=this.south,t[e+2]=this.east,t[e+3]=this.north,t}*[Symbol.iterator](){yield this.west,yield this.south,yield this.east,yield this.north}};ti.MAX=new ti(be.MIN_LONGITUDE,be.MIN_LATITUDE,be.MAX_LONGITUDE,be.MAX_LATITUDE);let fn=ti;function*mn(h,t,e,r,i){if(e>=r)return;const n=2**e,s=e+1,o=2**s,a=Math.floor(h/n*o),u=Math.floor(t/n*o),c=[[a,u,s],[a+1,u,s],[a,u+1,s],[a+1,u+1,s]];if(s<r)for(const l of c)for(const d of mn(...l,r,i))yield d;else for(const l of c)yield(i??new Ye).set(...l)}class Ye{constructor(t=0,e=0,r=0){this.x=t,this.y=e,this.z=r}set(t,e,r){return this.x=t,this.y=e,r!=null&&(this.z=r),this}clone(){return new Ye(this.x,this.y,this.z)}copy(t){return this.x=t.x,this.y=t.y,this.z=t.z,this}equals(t){return t.x===this.x&&t.y===this.y&&t.z===this.z}getParent(t=new Ye){const e=2**this.z,r=this.x/e,i=this.y/e,n=this.z-1,s=2**n;return t.set(Math.floor(r*s),Math.floor(i*s),n)}*traverseChildren(t,e){const{x:r,y:i,z:n}=this;for(const s of mn(r,i,n,n+t,e))yield s}fromArray(t,e=0){return this.x=t[e],this.y=t[e+1],this.z=t[e+2],this}toArray(t=[],e=0){return t[e]=this.x,t[e+1]=this.y,t[e+2]=this.z,t}*[Symbol.iterator](){yield this.x,yield this.y,yield this.z}}const pn=new Pt;class ei{constructor(t=2,e=1,r=fn.MAX){this.width=t,this.height=e,this.rectangle=r}clone(){return new ei(this.width,this.height,this.rectangle.clone())}copy(t){return this.width=t.width,this.height=t.height,this.rectangle.copy(t.rectangle),this}getSize(t,e=new Pt){return e.set(this.width<<t,this.height<<t)}getTile(t,e,r=new Ye){const i=this.getSize(e,pn),{rectangle:n}=this,s=n.width/i.x,o=n.height/i.y,{west:a,south:u,east:c}=n;let l=t.longitude;c<a&&(l+=Math.PI*2);let d=Math.floor((l-a)/s);d>=i.x&&(d=i.x-1);let f=Math.floor((t.latitude-u)/o);return f>=i.y&&(f=i.y-1),r.x=d,r.y=f,r.z=e,r}getRectangle(t,e=new fn){const r=this.getSize(t.z,pn),{rectangle:i}=this,n=i.width/r.x,s=i.height/r.y,{west:o,north:a}=i;return e.west=t.x*n+o,e.east=(t.x+1)*n+o,e.north=a-(r.y-t.y-1)*s,e.south=a-(r.y-t.y)*s,e}}var yo="Invariant failed";function br(h,t){if(!h)throw new Error(yo)}function yn(h){return h>=0?1:-1}function xo(h,t,e=new y,r=255){if(h===0&&t===0)return e.setScalar(0);let i=h/r*2-1,n=t/r*2-1;const s=1-(Math.abs(i)+Math.abs(n));if(s<0){const o=i;i=(1-Math.abs(n))*yn(o),n=(1-Math.abs(o))*yn(n)}return e.set(i,n,s).normalize()}const _r=new be,xn=new y;class go extends er{constructor(e,r){super();bn(this,"position");this.data=e;const{header:i,vertexData:n,triangleIndices:s,extensions:o}=e;if(n==null||s==null)throw new Error;this.position=new y(i.boundingSphereCenterX,i.boundingSphereCenterY,i.boundingSphereCenterZ);const a=new wt(s,1);this.setIndex(a);const u=this.createPositionAttribute(n,{rectangle:r,minHeight:e.header.minHeight,maxHeight:e.header.maxHeight});this.setAttribute("position",u);const c=this.createUvAttribute(n);if(this.setAttribute("uv",c),(o==null?void 0:o.vertexNormals)!=null){const l=this.createPackedEncodedNormalAttribute(o.vertexNormals);this.setAttribute("packedOctNormal",l)}}computeBoundingSphere(){const{header:e}=this.data;this.boundingSphere=new Or(new y,e.boundingSphereRadius)}computeVertexNormals(){var n;const e=(n=this.data.extensions)==null?void 0:n.vertexNormals;if(e==null){super.computeVertexNormals();return}br(e.length%2===0);const r=new Float32Array(e.length/2*3);for(let s=0,o=0;s<r.length;s+=3,o+=2){const a=e[o],u=e[o+1],c=xo(a,u,xn);r[s]=c.x,r[s+1]=c.y,r[s+2]=c.z}const i=new wt(r,3);this.setAttribute("normal",i),this.normalizeNormals()}createPositionAttribute(e,r){br(e.length%3===0);const i=e.length/3,n=e.subarray(0,i),s=e.subarray(i,i*2),o=e.subarray(i*2,i*3),a=new Float32Array(i*3),{rectangle:u,minHeight:c,maxHeight:l}=r,{west:d,south:f,east:m,north:p}=u;for(let A=0,b=0;A<a.length;A+=3,++b){const P=n[b],B=s[b],L=o[b];_r.longitude=Kr(d,m,P/32767),_r.latitude=Kr(f,p,B/32767),_r.height=Kr(c,l,L/32767);const S=_r.toECEF(xn).sub(this.position);a[A]=S.x,a[A+1]=S.y,a[A+2]=S.z}return new wt(a,3)}createUvAttribute(e){br(e.length%3===0);const r=e.length/3,i=e.subarray(0,r),n=e.subarray(r,r*2),s=new Int16Array(r*2);for(let o=0,a=0;o<s.length;o+=2,++a)s[o]=i[a],s[o+1]=n[a];return new wt(s,2,!0)}createPackedEncodedNormalAttribute(e){br(e.length%2===0);const r=new Float32Array(e.length/2);for(let i=0,n=0;i<r.length;++i,n+=2){const s=e[n],o=e[n+1];r[i]=256*s+o}return new wt(r,1)}}function gn(h,t){return new ni.Transfer(h,t)}function wo(h,t,{x:e,y:r,z:i},n=!0){const s=Un(h),a=new ei().copy(t).getRectangle({x:e,y:r,z:i}),u=new go(s,a);u.computeBoundingSphere(),n&&u.computeVertexNormals();const[c,l]=vi(u);return gn({geometry:c,position:u.position,header:s.header},l)}function bo(h,t=Math.PI/3){const e=Math.cos(t),r=(1+1e-10)*100,i=[new y,new y,new y],n=new y,s=new y,o=new y,a=new y;function u(p){const A=~~(p.x*r),b=~~(p.y*r),P=~~(p.z*r);return`${A},${b},${P}`}const c=h.index?h.toNonIndexed():h,l=c.attributes.position,d={};for(let p=0,A=l.count/3;p<A;p++){const b=3*p,P=i[0].fromBufferAttribute(l,b+0),B=i[1].fromBufferAttribute(l,b+1),L=i[2].fromBufferAttribute(l,b+2);n.subVectors(L,B),s.subVectors(P,B);const S=new y().crossVectors(n,s).normalize();for(let q=0;q<3;q++){const C=i[q],U=u(C);U in d||(d[U]=[]),d[U].push(S)}}const f=new Float32Array(l.count*3),m=new wt(f,3,!1);for(let p=0,A=l.count/3;p<A;p++){const b=3*p,P=i[0].fromBufferAttribute(l,b+0),B=i[1].fromBufferAttribute(l,b+1),L=i[2].fromBufferAttribute(l,b+2);n.subVectors(L,B),s.subVectors(P,B),o.crossVectors(n,s).normalize();for(let S=0;S<3;S++){const q=i[S],C=u(q),U=d[C];a.set(0,0,0);for(let Q=0,st=U.length;Q<st;Q++){const et=U[Q];o.dot(et)>e&&a.add(et)}a.normalize(),m.setXYZ(b+S,a.x,a.y,a.z)}}return c.setAttribute("normal",m),c}function _o(h,t){const e=bo(ls(h),t),r=e.getAttribute("normal"),i=new y,n=new y,s=new y;for(let u=0;u<r.count;u+=3)i.fromBufferAttribute(r,u+0),n.fromBufferAttribute(r,u+1),s.fromBufferAttribute(r,u+2),(i.length()<.5||n.length()<.5||s.length()<.5)&&(r.setXYZ(u+0,0,0,1),r.setXYZ(u+1,0,0,1),r.setXYZ(u+2,0,0,1));const[o,a]=vi(e);return gn(o,a)}const Mo={toCreasedNormals:_o,createTerrainGeometry:wo};ni.worker(Mo)})();
