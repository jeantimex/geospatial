import{S,W as R,N as F,P as H,a as I,R as W,C as l,X as j,M as G,b as k,T as v,H as A,c as N,V as x}from"./index-CYDsy1T_.js";import{R as z,L as B,x as U,N as X,P as q,a as O,E as V,b as J,c as K,d as i,e as Q,T as Y,f as Z,S as _,u as $}from"./shared-F2N6z35j.js";import{G as ee}from"./index-BTeDwv9f.js";import{g as te,a as ne,b as ae}from"./celestialDirections-CJAFHZKf.js";function oe(t){const{image:r}=t,{width:w,height:p}=r;if(w!==p)throw new Error("Hald CLUT image must be square.");const u=Math.cbrt(w*p);if(u%1!==0)throw new Error("Hald CLUT image must be cubic.");const{data:m}=z.from(r),o=new B(m,u);return o.name=t.name,o.type=t.type,t.colorSpace=o.colorSpace,o}let P,n,e,s,c,d,a,T;const f=new x,h=new x,g=new N,se=new Date("2025-01-01T15:00:00+09:00");function re(){s=new S,n=new R({powerPreference:"high-performance",antialias:!0,stencil:!1,depth:!1,logarithmicDepthBuffer:!0}),n.setPixelRatio(window.devicePixelRatio),n.setSize(window.innerWidth,window.innerHeight),n.toneMapping=F,n.toneMappingExposure=10,n.shadowMap.enabled=!0,n.shadowMap.type=H;const t=document.getElementById("container");t&&t.appendChild(n.domElement);const r=window.innerWidth/window.innerHeight;e=new I(75,r,10,1e6);const w=139.7671,p=35.6812,u=180,m=-10,o=4500,C=new W(l(w),l(p)).toECEF();new j(o,l(u),l(m)).decompose(C,e.position,e.quaternion),e.up.set(0,1,0),e.aspect=r,e.updateProjectionMatrix(),c=new U;const E=new G(new k(2,2),c);E.frustumCulled=!1,s.add(E),P=new ee(s,e,n),s.add(P.tiles.group),d=new X(e,{correctGeometricError:!0,correctAltitude:!0,inscatter:!0,photometric:!0,skyIrradiance:!0,sunIrradiance:!0,transmittance:!0,irradianceScale:2/Math.PI,sky:!0,sun:!0,moon:!0});const M="/geospatial/";new q().setTypeFromRenderer(n).load(M+"assets/atmosphere",ie);const b=new v,D=M+"assets/clut/Fuji/Fuji 160C 1 -.png";b.load(D,L=>{T=oe(L),new O(T)}),a=new V(n,{frameBufferType:A,multisampling:8});const y=new J(s,e);y.enabled=!1,a.addPass(new K(s,e)),a.addPass(y),a.addPass(new i(e,d)),a.addPass(new i(e,new Q)),a.addPass(new i(e,new Y({mode:Z.AGX}))),a.addPass(new i(e,new _)),a.addPass(new i(e,new $)),window.addEventListener("resize",ce)}function ie(t){Object.assign(c,t),Object.assign(d,t),n.setAnimationLoop(de)}function ce(){e.aspect=window.innerWidth/window.innerHeight,e.updateProjectionMatrix(),n.setSize(window.innerWidth,window.innerHeight)}function de(){const t=se;te(t,g),ne(t,f).applyMatrix4(g),ae(t,h).applyMatrix4(g),c.sunDirection.copy(f),c.moonDirection.copy(h),d.sunDirection.copy(f),d.moonDirection.copy(h),P.update(),a==null||a.render()}window.addEventListener("load",re);
